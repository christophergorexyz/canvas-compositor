(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.CanvasCompositor=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}module.exports=_assertThisInitialized},{}],2:[function(require,module,exports){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}module.exports=_classCallCheck},{}],3:[function(require,module,exports){var setPrototypeOf=require("./setPrototypeOf");function isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(e){return false}}function _construct(Parent,args,Class){if(isNativeReflectConstruct()){module.exports=_construct=Reflect.construct}else{module.exports=_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor;if(Class)setPrototypeOf(instance,Class.prototype);return instance}}return _construct.apply(null,arguments)}module.exports=_construct},{"./setPrototypeOf":10}],4:[function(require,module,exports){function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}module.exports=_createClass},{}],5:[function(require,module,exports){function _getPrototypeOf(o){module.exports=_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}module.exports=_getPrototypeOf},{}],6:[function(require,module,exports){var setPrototypeOf=require("./setPrototypeOf");function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)setPrototypeOf(subClass,superClass)}module.exports=_inherits},{"./setPrototypeOf":10}],7:[function(require,module,exports){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports=_interopRequireDefault},{}],8:[function(require,module,exports){function _isNativeFunction(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1}module.exports=_isNativeFunction},{}],9:[function(require,module,exports){var _typeof=require("../helpers/typeof");var assertThisInitialized=require("./assertThisInitialized");function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return assertThisInitialized(self)}module.exports=_possibleConstructorReturn},{"../helpers/typeof":11,"./assertThisInitialized":1}],10:[function(require,module,exports){function _setPrototypeOf(o,p){module.exports=_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}module.exports=_setPrototypeOf},{}],11:[function(require,module,exports){function _typeof2(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof2=function _typeof2(obj){return typeof obj}}else{_typeof2=function _typeof2(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof2(obj)}function _typeof(obj){if(typeof Symbol==="function"&&_typeof2(Symbol.iterator)==="symbol"){module.exports=_typeof=function _typeof(obj){return _typeof2(obj)}}else{module.exports=_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)}}return _typeof(obj)}module.exports=_typeof},{}],12:[function(require,module,exports){var getPrototypeOf=require("./getPrototypeOf");var setPrototypeOf=require("./setPrototypeOf");var isNativeFunction=require("./isNativeFunction");var construct=require("./construct");function _wrapNativeSuper(Class){var _cache=typeof Map==="function"?new Map:undefined;module.exports=_wrapNativeSuper=function _wrapNativeSuper(Class){if(Class===null||!isNativeFunction(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function")}if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return construct(Class,arguments,getPrototypeOf(this).constructor)}Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return setPrototypeOf(Wrapper,Class)};return _wrapNativeSuper(Class)}module.exports=_wrapNativeSuper},{"./construct":3,"./getPrototypeOf":5,"./isNativeFunction":8,"./setPrototypeOf":10}],13:[function(require,module,exports){},{}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MVC_VIEW_ELEMENT=exports.MVC_INPUT_CHANGED=exports.MVC_PROPERTY_CHANGED=exports.MVC_MODEL_MODIFIED=exports.MVC_CHECK_GROUP=exports.MVC_RADIO_GROUP=exports.MVC_CONTROLS=exports.MVC_OBSERVES=void 0;var APP_PREFIX="mvc";var MVC_OBSERVES="".concat(APP_PREFIX,"-observes");exports.MVC_OBSERVES=MVC_OBSERVES;var MVC_CONTROLS="".concat(APP_PREFIX,"-controls");exports.MVC_CONTROLS=MVC_CONTROLS;var MVC_RADIO_GROUP="".concat(APP_PREFIX,"-radio-group");exports.MVC_RADIO_GROUP=MVC_RADIO_GROUP;var MVC_CHECK_GROUP="".concat(APP_PREFIX,"-check-group");exports.MVC_CHECK_GROUP=MVC_CHECK_GROUP;var MVC_MODEL_MODIFIED="".concat(APP_PREFIX,"-model-modified");exports.MVC_MODEL_MODIFIED=MVC_MODEL_MODIFIED;var MVC_PROPERTY_CHANGED="".concat(APP_PREFIX,"-property-changed");exports.MVC_PROPERTY_CHANGED=MVC_PROPERTY_CHANGED;var MVC_INPUT_CHANGED="".concat(APP_PREFIX,"-input-changed");exports.MVC_INPUT_CHANGED=MVC_INPUT_CHANGED;var MVC_VIEW_ELEMENT="".concat(APP_PREFIX,"-view");exports.MVC_VIEW_ELEMENT=MVC_VIEW_ELEMENT},{}],15:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _wrapNativeSuper2=_interopRequireDefault(require("@babel/runtime/helpers/wrapNativeSuper"));var _view=_interopRequireDefault(require("../view"));var _model=_interopRequireDefault(require("../model"));var MVCView=function(_HTMLElement){(0,_inherits2["default"])(MVCView,_HTMLElement);function MVCView(){(0,_classCallCheck2["default"])(this,MVCView);return(0,_possibleConstructorReturn2["default"])(this,(0,_getPrototypeOf2["default"])(MVCView).call(this))}(0,_createClass2["default"])(MVCView,[{key:"connectedCallback",value:function connectedCallback(){this._shadow=this.attachShadow({mode:"open"});var formNode=document.createElement("form");var slot=document.createElement("slot");formNode.append(slot);this._shadow.appendChild(formNode)}},{key:"model",get:function get(){return this._model},set:function set(model){if(this._model){throw new Error("The model may only be set once.")}this._model=new _model["default"](model);this._view=new _view["default"](this,this._model)}}]);return MVCView}((0,_wrapNativeSuper2["default"])(HTMLElement));exports["default"]=MVCView},{"../model":18,"../view":19,"@babel/runtime/helpers/classCallCheck":2,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/getPrototypeOf":5,"@babel/runtime/helpers/inherits":6,"@babel/runtime/helpers/interopRequireDefault":7,"@babel/runtime/helpers/possibleConstructorReturn":9,"@babel/runtime/helpers/wrapNativeSuper":12}],16:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var EventEmitter=function(){function EventEmitter(){(0,_classCallCheck2["default"])(this,EventEmitter);this.listeners={}}(0,_createClass2["default"])(EventEmitter,[{key:"addEventListener",value:function addEventListener(type,callback){if(!(type in this.listeners)){this.listeners[type]=[]}this.listeners[type].push(callback)}},{key:"removeEventListener",value:function removeEventListener(type,callback){if(!(type in this.listeners)){return}var stack=this.listeners[type];for(var i=0,l=stack.length;i<l;i++){if(stack[i]===callback){stack.splice(i,1);return}}}},{key:"dispatchEvent",value:function dispatchEvent(event){if(!(event.type in this.listeners)){return true}var stack=this.listeners[event.type].slice();for(var i=0,l=stack.length;i<l;i++){stack[i].call(this,event)}return!event.defaultPrevented}},{key:"listensFor",value:function listensFor(type){return!!this.listeners[type]}},{key:"hasListener",value:function hasListener(type,callback){return!!this.listeners[type]?this.listeners[type].indexOf(callback)>=0:false}}]);return EventEmitter}();exports["default"]=EventEmitter},{"@babel/runtime/helpers/classCallCheck":2,"@babel/runtime/helpers/createClass":4,"@babel/runtime/helpers/interopRequireDefault":7}],17:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"Model",{enumerable:true,get:function get(){return _model["default"]}});Object.defineProperty(exports,"View",{enumerable:true,get:function get(){return _view["default"]}});Object.defineProperty(exports,"EventEmitter",{enumerable:true,get:function get(){return _eventEmitter["default"]}});var _model=_interopRequireDefault(require("./model"));var _view=_interopRequireDefault(require("./view"));var _eventEmitter=_interopRequireDefault(require("./event-emitter"));var _mvcView=_interopRequireDefault(require("./custom-elements/mvc-view"));var _config=require("./config");window.customElements.define(_config.MVC_VIEW_ELEMENT,_mvcView["default"])},{"./config":14,"./custom-elements/mvc-view":15,"./event-emitter":16,"./model":18,"./view":19,"@babel/runtime/helpers/interopRequireDefault":7}],18:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _eventEmitter=_interopRequireDefault(require("./event-emitter"));var _config=require("./config");var Model=function(_EventEmitter){(0,_inherits2["default"])(Model,_EventEmitter);function Model(dataModel){var _this;(0,_classCallCheck2["default"])(this,Model);_this=(0,_possibleConstructorReturn2["default"])(this,(0,_getPrototypeOf2["default"])(Model).call(this));var _loop=function _loop(){var k=_Object$keys[_i];Object.defineProperty((0,_assertThisInitialized2["default"])(_this),k,{innumerable:true,get:function get(){return dataModel[k]},set:function set(val){dataModel[k]=val;var e=new CustomEvent(_config.MVC_PROPERTY_CHANGED,{detail:{model:dataModel,property:k,value:val}});_this.dispatchEvent(e)}})};for(var _i=0,_Object$keys=Object.keys(dataModel);_i<_Object$keys.length;_i++){_loop()}Object.defineProperty((0,_assertThisInitialized2["default"])(_this),"model",{innumerable:true,get:function get(){return dataModel}});var modify=function modify(val){Object.assign(dataModel,val);var e=new CustomEvent(_config.MVC_MODEL_MODIFIED,{detail:{updates:val,model:dataModel,properties:[Object.keys(val)],values:[Object.values(val)]}});_this.dispatchEvent(e)};Object.defineProperty((0,_assertThisInitialized2["default"])(_this),"modify",{value:modify});return _this}return Model}(_eventEmitter["default"]);exports["default"]=Model},{"./config":14,"./event-emitter":16,"@babel/runtime/helpers/assertThisInitialized":1,"@babel/runtime/helpers/classCallCheck":2,"@babel/runtime/helpers/getPrototypeOf":5,"@babel/runtime/helpers/inherits":6,"@babel/runtime/helpers/interopRequireDefault":7,"@babel/runtime/helpers/possibleConstructorReturn":9}],19:[function(require,module,exports){"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _config=require("./config");var _eventEmitter=_interopRequireDefault(require("./event-emitter"));var View=function(_EventEmitter){(0,_inherits2["default"])(View,_EventEmitter);function View(viewDOM,model){var _this;(0,_classCallCheck2["default"])(this,View);_this=(0,_possibleConstructorReturn2["default"])(this,(0,_getPrototypeOf2["default"])(View).call(this));var observers=viewDOM.querySelectorAll("[".concat(_config.MVC_OBSERVES,"]"));var controls=viewDOM.querySelectorAll("[".concat(_config.MVC_CONTROLS,"]"));var radioGroupObservers=viewDOM.querySelectorAll("[".concat(_config.MVC_OBSERVES,"][").concat(_config.MVC_RADIO_GROUP,"]"));var radioGroupControls=viewDOM.querySelectorAll("[".concat(_config.MVC_CONTROLS,"][").concat(_config.MVC_RADIO_GROUP,"]"));var checkGroupObservers=viewDOM.querySelectorAll("[".concat(_config.MVC_OBSERVES,"][").concat(_config.MVC_CHECK_GROUP,"]"));var checkGroupControls=viewDOM.querySelectorAll("[".concat(_config.MVC_CONTROLS,"][").concat(_config.MVC_CHECK_GROUP,"]"));radioGroupObservers=Array.prototype.map.call(radioGroupObservers,function(o){return o});radioGroupControls=Array.prototype.map.call(radioGroupControls,function(c){return c});checkGroupObservers=Array.prototype.map.call(checkGroupObservers,function(o){return o});checkGroupControls=Array.prototype.map.call(checkGroupControls,function(c){return c});function getInputValue(control){var inputType=control.getAttribute("type");switch(inputType){case"button":case"file":case"image":case"password":case"reset":case"submit":throw new TypeError("Inputs of type ".concat(inputType," cannot observe models"));break;case"checkbox":return control.checked;break;default:return control.value;break}}function getControlValue(control){switch(control.tagName){case"INPUT":return getInputValue(control);case"FIELDSET":return fieldsetGetAdapter.get(control)();case"SELECT":return control.value;default:return control.innerHTML}}function updateInputValue(observer,value){var inputType=observer.getAttribute("type");switch(inputType){case"button":case"file":case"image":case"reset":case"submit":throw new TypeError("Inputs of type ".concat(inputType," do not have values"));break;case"password":throw new TypeError("Inputs of type ".concat(inputType," may not be modified by controllers"));case"checkbox":observer.checked=value;break;default:observer.value=value;break}}function updateObserver(observer,value){switch(observer.tagName){case"INPUT":updateInputValue(observer,value);break;case"FIELDSET":if(observer.hasAttribute(_config.MVC_RADIO_GROUP)&&!fieldsetOptionsMap.get(observer).includes(value)){throw new RangeError("The value supplied, ".concat(value,", is not a valid option"))}else if(observer.hasAttribute(_config.MVC_CHECK_GROUP)&&Object.keys(value).filter(function(v){return!fieldsetOptionsMap.get(observer).includes(v)}).length){throw new RangeError("At least one of the values supplied, ".concat(value,", is not a valid option"))}fieldsetSetAdapter.get(observer)(value);break;case"SELECT":if(!selectOptionsMap.get(observer).includes(value)){throw new RangeError("The value supplied, ".concat(value,", is not a valid option"))}observer.value=value;break;default:observer.innerHTML=value;break}}var fieldsetGetAdapter=new Map;var _loop=function _loop(i){var addEventListeners=function addEventListeners(c){var _loop3=function _loop3(val){c.addEventListener("change",function(e){var ce=new CustomEvent(_config.MVC_INPUT_CHANGED,{target:e.target,detail:{property:controlledValues[val],value:getControlValue(controls[i])}});model[controlledValues[val]]=getControlValue(controls[i]);_this.dispatchEvent(ce)})};for(var val in controlledValues){_loop3(val)}};var controlledValues=controls[i].getAttribute(_config.MVC_CONTROLS).split(",");if(radioGroupControls.includes(controls[i])){var radioGroupName=controls[i].getAttribute(_config.MVC_RADIO_GROUP);var radioForm=controls[i].closest("form");var nodeList=radioForm?radioForm.elements[radioGroupName]:document.getElementsByName(radioGroupName);fieldsetGetAdapter.set(controls[i],radioForm?function(){return nodeList.value}:function(){return controls[i].querySelector(":checked").value});nodeList.forEach(function(n){addEventListeners(n)})}else if(checkGroupControls.includes(controls[i])){var _nodeList=controls[i].querySelectorAll('[type="checkbox"]');fieldsetGetAdapter.set(controls[i],function(){var result={};_nodeList.forEach(function(n){result[n.value]=n.checked});return result});_nodeList.forEach(function(n){addEventListeners(n)})}else{addEventListeners(controls[i])}};for(var i=0;i<controls.length;i++){_loop(i)}var fieldsetOptionsMap=new Map;var selectOptionsMap=new Map;var fieldsetSetAdapter=new Map;var _loop2=function _loop2(i){if(radioGroupObservers.includes(observers[i])){var radioGroupName=observers[i].getAttribute(_config.MVC_RADIO_GROUP);var radioForm=observers[i].closest("form");var nodeList=radioForm?radioForm.elements[radioGroupName]:document.getElementsByName(radioGroupName);fieldsetSetAdapter.set(observers[i],radioForm?function(val){return nodeList.value=val}:function(val){return nodeList.forEach(function(n){n.checked=false;if(n.value===val){n.checked=true}})});var options=[];nodeList.forEach(function(o){options.push(o.value)});fieldsetOptionsMap.set(observers[i],options)}else if(checkGroupObservers.includes(observers[i])){var _nodeList2=observers[i].querySelectorAll('[type="checkbox"]');fieldsetSetAdapter.set(observers[i],function(val){_nodeList2.forEach(function(n){n.checked=val[n.value]})});var _options=[];_nodeList2.forEach(function(o){_options.push(o.value)});fieldsetOptionsMap.set(observers[i],_options)}else if(observers[i].tagName==="SELECT"){var _options2=[];observers[i].querySelectorAll("option").forEach(function(o){_options2.push(o.value)});selectOptionsMap.set(observers[i],_options2)}var observedValues=observers[i].getAttribute(_config.MVC_OBSERVES).split(",");var _loop4=function _loop4(val){model.addEventListener(_config.MVC_PROPERTY_CHANGED,function(e){if(observedValues[val]===e.detail.property&&e.target!==observers[i]){updateObserver(observers[i],e.detail.value)}})};for(var val in observedValues){_loop4(val)}};for(var i=0;i<observers.length;i++){_loop2(i)}model.addEventListener(_config.MVC_MODEL_MODIFIED,function(e){for(var i=0;i<observers.length;i++){var observedValues=observers[i].getAttribute(_config.MVC_OBSERVES).split(",");for(var val in observedValues){var updatedVal=e.detail.updates[observedValues[val]];if(updatedVal){updateObserver(observers[i],updatedVal)}}}});return _this}return View}(_eventEmitter["default"]);exports["default"]=View},{"./config":14,"./event-emitter":16,"@babel/runtime/helpers/classCallCheck":2,"@babel/runtime/helpers/getPrototypeOf":5,"@babel/runtime/helpers/inherits":6,"@babel/runtime/helpers/interopRequireDefault":7,"@babel/runtime/helpers/possibleConstructorReturn":9}],20:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var NDArray_1=require("./NDArray");var Vector_1=require("./Vector");var nblas;try{nblas=require("nblas")}catch(err){}var magicHelper=function(n,x,y){return(x+y*2+1)%n};var Matrix=function(_super){__extends(Matrix,_super);function Matrix(data,options){var _this=this;if(typeof data==="number"&&typeof options==="number"){_this=_super.call(this,new Float32Array(data*options),{shape:[data,options]})||this}else{_this=_super.call(this,data,options)||this}return _this}Matrix.add=function(a,b){return a.copy().add(b)};Matrix.augment=function(a,b){return a.copy().augment(b)};Matrix.binOp=function(a,b,op){return a.copy().binOp(b,op)};Matrix.equals=function(a,b){return a.equals(b)};Matrix.fill=function(r,c,value,type){if(value===void 0){value=0}if(type===void 0){type=Float32Array}if(r<=0||c<=0){throw new Error("invalid size")}var size=r*c;var data=new type(size);return new Matrix(data,{shape:[r,c]}).fill(value)};Matrix.identity=function(size,type){if(type===void 0){type=Float32Array}return Matrix.fill(size,size,function(i){return i%size===Math.floor(i/size)?1:0},type)};Matrix.magic=function(size,type){if(type===void 0){type=Float32Array}if(size<0){throw new Error("invalid size")}var data=new type(size*size);var i;var j;for(i=0;i<size;i+=1){for(j=0;j<size;j+=1){data[(size-i-1)*size+(size-j-1)]=magicHelper(size,size-j-1,i)*size+magicHelper(size,j,i)+1}}return new Matrix(data,{shape:[size,size]})};Matrix.multiply=function(a,b){return a.multiply(b)};Matrix.ones=function(r,c,type){if(type===void 0){type=Float32Array}return Matrix.fill(r,c,1,type)};Matrix.plu=function(matrix){return matrix.copy().plu()};Matrix.product=function(a,b){return a.copy().product(b)};Matrix.random=function(r,c,min,max,type){if(min===void 0){min=0}if(max===void 0){max=1}if(type===void 0){type=Float32Array}return Matrix.fill(r,c,min,type).map(function(value){return value+Math.random()*(max-min)})};Matrix.rank=function(matrix){return matrix.copy().rank()};Matrix.scale=function(a,scalar){return a.copy().scale(scalar)};Matrix.subtract=function(a,b){return a.copy().subtract(b)};Matrix.zeros=function(r,c,type){if(type===void 0){type=Float32Array}return Matrix.fill(r,c,0,type)};Matrix.prototype.augment=function(matrix){var _a=this.shape,r1=_a[0],c1=_a[1];var _b=matrix.shape,r2=_b[0],c2=_b[1];if(r2===0||c2===0){return this}if(r1!==r2){throw new Error("rows do not match")}var d1=this.data;var d2=matrix.data;var length=c1+c2;var data=new this.type(length*r1);var i;var j;for(i=0;i<r1;i+=1){for(j=0;j<c1;j+=1){data[i*length+j]=d1[i*c1+j]}}for(i=0;i<r2;i+=1){for(j=0;j<c2;j+=1){data[i*length+j+c1]=d2[i*c2+j]}}this.shape=[r1,length];this.length=data.length;this.data=data;return this};Matrix.prototype.binOp=function(matrix,op){var _a=this.shape,r1=_a[0],c1=_a[1];var _b=matrix.shape,r2=_b[0],c2=_b[1];if(r1!==r2||c1!==c2){throw new Error("sizes do not match!")}var _c=this,d1=_c.data,length=_c.length;var d2=matrix.data;var i;for(i=0;i<length;i+=1){d1[i]=op(d1[i],d2[i],i)}return this};Matrix.prototype.check=function(i,j){var _a=this.shape,r=_a[0],c=_a[1];if(isNaN(i)||isNaN(j)){throw new Error("one of the indices is not a number")}if(i<0||j<0||i>r-1||j>c-1){throw new Error("index out of bounds")}};Matrix.prototype.determinant=function(){var _a=this.shape,r=_a[0],c=_a[1];if(r!==c){throw new Error("matrix is not square")}var _b=Matrix.plu(this),lu=_b[0],ipiv=_b[1];var product=1;var sign=1;var i;for(i=0;i<r;i+=1){if(i!==ipiv[i]){sign*=-1}}for(i=0;i<r;i+=1){product*=lu.data[i*c+i]}return sign*product};Matrix.prototype.diag=function(){var data=this.data;var _a=this.shape,r=_a[0],c=_a[1];var diag=new this.type(Math.min(r,c));var i;for(i=0;i<r&&i<c;i+=1){diag[i]=data[i*c+i]}return new Vector_1.Vector(diag)};Matrix.prototype.each=function(callback){var c=this.shape[1];var _a=this,data=_a.data,length=_a.length;var i;for(i=0;i<length;i+=1){callback.call(this,data[i],c===0?0:Math.floor(i/c),i%c)}return this};Matrix.prototype.gauss=function(){var _a=this.shape,r=_a[0],c=_a[1];var copy=this.copy();var lead=0;var pivot;var leadValue;var i;var j;var k;for(i=0;i<r;i+=1){if(c<=lead){throw new Error("matrix is singular")}j=i;while(copy.data[j*c+lead]===0){j+=1;if(r===j){j=i;lead+=1;if(c===lead){throw new Error("matrix is singular")}}}copy.swap(i,j);pivot=copy.data[i*c+lead];if(pivot!==0){for(k=0;k<c;k+=1){copy.data[i*c+k]=copy.data[i*c+k]/pivot}}for(j=0;j<r;j+=1){leadValue=copy.data[j*c+lead];if(j!==i){for(k=0;k<c;k+=1){copy.data[j*c+k]=copy.data[j*c+k]-copy.data[i*c+k]*leadValue}}}lead+=1}for(i=0;i<r;i+=1){pivot=0;for(j=0;j<c;j+=1){if(pivot===0){pivot=copy.data[i*c+j]}}if(pivot===0){for(k=0;k<c;k+=1){copy.data[i*c+k]=copy.data[i*c+k]/pivot}}}return copy};Matrix.prototype.get=function(i,j){this.check(i,j);return this.data[i*this.shape[1]+j]};Matrix.prototype.inverse=function(){var _a=this.shape,r=_a[0],c=_a[1];if(r!==c){throw new Error("invalid dimensions")}var identity=Matrix.identity(r);var augmented=Matrix.augment(this,identity);var gauss=augmented.gauss();var left=Matrix.zeros(r,c);var right=Matrix.zeros(r,c);var n=gauss.shape[1];var i;var j;for(i=0;i<r;i+=1){for(j=0;j<n;j+=1){if(j<c){left.set(i,j,gauss.get(i,j))}else{right.set(i,j-r,gauss.get(i,j))}}}if(!left.equals(Matrix.identity(r))){throw new Error("matrix is not invertible")}return right};Matrix.prototype.lu=function(){var _a=this.shape,r=_a[0],c=_a[1];var _b=Matrix.plu(this),plu=_b[0],ipiv=_b[1];var lower=plu.copy();var upper=plu.copy();var i;var j;for(i=0;i<r;i+=1){for(j=i;j<c;j+=1){lower.data[i*c+j]=i===j?1:0}}for(i=0;i<r;i+=1){for(j=0;j<i&&j<c;j+=1){upper.data[i*c+j]=0}}return[lower,upper,ipiv]};Matrix.prototype.lusolve=function(rhs,ipiv){var data=this.data;var _a=rhs.shape,n=_a[0],nrhs=_a[1];var x=rhs.data;var i;var j;var k;for(i=0;i<ipiv.length;i+=1){if(i!==ipiv[i]){rhs.swap(i,ipiv[i])}}for(k=0;k<nrhs;k+=1){for(i=0;i<n;i+=1){for(j=0;j<i;j+=1){x[i*nrhs+k]-=data[i*n+j]*x[j*nrhs+k]}}for(i=n-1;i>=0;i-=1){for(j=i+1;j<n;j+=1){x[i*nrhs+k]-=data[i*n+j]*x[j*nrhs+k]}x[i*nrhs+k]/=data[i*n+i]}}return rhs};Matrix.prototype.map=function(callback){var c=this.shape[1];var length=this.length;var mapped=this.copy();var data=mapped.data;var i;for(i=0;i<length;i+=1){data[i]=callback.call(mapped,data[i],c===0?0:Math.floor(i/c),i%c,data)}return mapped};Matrix.prototype.multiply=function(matrix){var _a=this.shape,r1=_a[0],c1=_a[1];var _b=matrix.shape,r2=_b[0],c2=_b[1];if(c1!==r2){throw new Error("sizes do not match")}var d1=this.data;var d2=matrix.data;var data=new this.type(r1*c2);try{nblas.gemm(d1,d2,data,r1,c2,c1)}catch(err){var i=void 0;var j=void 0;var k=void 0;var sum=void 0;for(i=0;i<r1;i+=1){for(j=0;j<c2;j+=1){sum=0;for(k=0;k<c1;k+=1){sum+=d1[i*c1+k]*d2[j+k*c2]}data[i*c2+j]=sum}}}return new Matrix(data,{shape:[r1,c2]})};Object.defineProperty(Matrix.prototype,"T",{get:function(){return this.transpose()},enumerable:true,configurable:true});Matrix.prototype.plu=function(){var data=this.data;var n=this.shape[0];var ipiv=new Int32Array(n);var max;var abs;var diag;var p;var i;var j;var k;for(k=0;k<n;k+=1){p=k;max=Math.abs(data[k*n+k]);for(j=k+1;j<n;j+=1){abs=Math.abs(data[j*n+k]);if(max<abs){max=abs;p=j}}ipiv[k]=p;if(p!==k){this.swap(k,p)}diag=data[k*n+k];for(i=k+1;i<n;i+=1){data[i*n+k]/=diag}for(i=k+1;i<n;i+=1){for(j=k+1;j<n-1;j+=1){data[i*n+j]-=data[i*n+k]*data[k*n+j];j+=1;data[i*n+j]-=data[i*n+k]*data[k*n+j]}if(j===n-1){data[i*n+j]-=data[i*n+k]*data[k*n+j]}}}return[this,ipiv]};Matrix.prototype.rank=function(){var vectors=this.toArray().map(function(row){return new Vector_1.Vector(row)});var _a=this.shape,r=_a[0],c=_a[1];var counter=0;var tmp;var pivot;var target;var scalar;var i;var j;for(i=0;i<r-1;i+=1){pivot=undefined;for(j=i;j<r;j+=1){if(vectors[i].get(i)!==0){if(i!==j){tmp=vectors[i];vectors[i]=vectors[j];vectors[j]=tmp}pivot=vectors[i];break}}if(pivot===undefined){continue}for(j=i+1;j<r;j+=1){target=vectors[j];scalar=target.get(i)/pivot.get(i);vectors[j]=target.subtract(pivot.scale(scalar))}}for(i=0;i<r;i+=1){for(j=0;j<c;j+=1){if(vectors[i].get(j)!==0){counter+=1;break}}}return counter};Matrix.prototype.reduce=function(callback,initialValue){var c=this.shape[1];var length=this.length;if(length===0&&initialValue===undefined){throw new Error("reduce of empty matrix with no initial value.")}var data=this.data;var i;var value;if(initialValue===undefined){value=data[0];i=1}else{value=initialValue;i=0}for(;i<length;i+=1){value=callback.call(this,value,data[i],c===0?0:Math.floor(i/c),i%c)}return value};Matrix.prototype.rowAdd=function(dest,source,scalar){if(scalar===void 0){scalar=1}this.check(dest,0);this.check(source,0);var c=this.shape[1];var i;for(i=0;i<c;i+=1){this.set(dest,i,this.get(dest,i)+this.get(source,i)*scalar)}return this};Matrix.prototype.set=function(i,j,value){this.check(i,j);this.data[i*this.shape[1]+j]=value;return this};Matrix.prototype.solve=function(rhs){var _a=Matrix.plu(this),lu=_a[0],ipiv=_a[1];return lu.lusolve(rhs.copy(),ipiv)};Matrix.prototype.swap=function(i,j){var _a=this.shape,r=_a[0],c=_a[1];if(i<0||j<0||i>r-1||j>r-1){throw new Error("index out of bounds")}var copy=this.data.slice(i*c,(i+1)*c);this.data.copyWithin(i*c,j*c,(j+1)*c);this.data.set(copy,j*c);return this};Matrix.prototype.toArray=function(){var _a=this.shape,r=_a[0],c=_a[1];var result=[];var i;for(i=0;i<r;i+=1){result.push(Array.prototype.slice.call(this.data.subarray(i*c,(i+1)*c)))}return result};Matrix.prototype.toString=function(){var _a=this.shape,r=_a[0],c=_a[1];var result=[];var i;for(i=0;i<r;i+=1){result.push("["+this.data.subarray(i*c,(i+1)*c)+"]")}return"["+result.join(", \n")+"]"};Matrix.prototype.trace=function(){var diag=this.diag();var length=diag.length;var result=0;var i;for(i=0;i<length;i+=1){result+=diag.get(i)}return result};Matrix.prototype.transpose=function(){var _a=this.shape,r=_a[0],c=_a[1];var data=new this.type(c*r);var i;var j;for(i=0;i<r;i+=1){for(j=0;j<c;j+=1){data[j*r+i]=this.data[i*c+j]}}return new Matrix(data,{shape:[c,r]})};return Matrix}(NDArray_1.NDArray);exports.Matrix=Matrix;try{window.Matrix=Matrix}catch(err){}},{"./NDArray":21,"./Vector":22,nblas:13}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("./util");var nblas;try{nblas=require("nblas")}catch(err){}var abs=Math.abs,acos=Math.acos,acosh=Math.acosh,asin=Math.asin,asinh=Math.asinh,atan=Math.atan,atanh=Math.atanh,cbrt=Math.cbrt,ceil=Math.ceil,cos=Math.cos,cosh=Math.cosh,exp=Math.exp,expm1=Math.expm1,floor=Math.floor,fround=Math.fround,log=Math.log,log1p=Math.log1p,log10=Math.log10,log2=Math.log2,pow=Math.pow,round=Math.round,sign=Math.sign,sin=Math.sin,sinh=Math.sinh,sqrt=Math.sqrt,tan=Math.tan,tanh=Math.tanh,trunc=Math.trunc;var NDArray=function(){function NDArray(data,options){this.data=new Float32Array(0);this.length=0;this.shape=[0];this.type=Float32Array;if(util_1.isTypedArray(data)){this.data=data;this.shape=typeof options==="object"?options.shape:[this.data.length];this.length=this.data.length;this.type=util_1.type(data)}else if(data instanceof Array){this.data=new Float32Array(util_1.flatten(data));this.shape=util_1.shape(data);this.length=this.data.length}else if(data instanceof NDArray){return data.copy()}}NDArray.prototype.abs=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=abs(this.data[i])}return this};NDArray.prototype.acos=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=acos(this.data[i])}return this};NDArray.prototype.acosh=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=acosh(this.data[i])}return this};NDArray.prototype.add=function(x,alpha){if(alpha===void 0){alpha=1}this.equilateral(x);this.equidimensional(x);try{nblas.axpy(x.data,this.data,alpha)}catch(err){var _a=this,d1=_a.data,l1=_a.length;var d2=x.data;var i=void 0;for(i=0;i<l1;i+=1){d1[i]+=alpha*d2[i]}}return this};NDArray.prototype.asin=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=asin(this.data[i])}return this};NDArray.prototype.asinh=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=asinh(this.data[i])}return this};NDArray.prototype.atan=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=atan(this.data[i])}return this};NDArray.prototype.atanh=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=atanh(this.data[i])}return this};NDArray.prototype.cbrt=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=cbrt(this.data[i])}return this};NDArray.prototype.ceil=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=ceil(this.data[i])}return this};NDArray.prototype.copy=function(){var copy=Object.assign(Object.create(Object.getPrototypeOf(this)),this);copy.data=new this.type(this.data);copy.shape=this.shape;copy.length=this.length;copy.type=this.type;return copy};NDArray.prototype.cos=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=cos(this.data[i])}return this};NDArray.prototype.cosh=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=cosh(this.data[i])}return this};NDArray.prototype.dot=function(x){this.equilateral(x);this.equidimensional(x);var _a=this,d1=_a.data,l1=_a.length;var d2=x.data;try{return nblas.dot(d1,d2)}catch(err){var result=0;var i=void 0;for(i=0;i<l1;i+=1){result+=d1[i]*d2[i]}return result}};NDArray.prototype.equals=function(x){this.equilateral(x);this.equidimensional(x);var _a=this,d1=_a.data,l1=_a.length;var d2=x.data;var i;for(i=0;i<l1;i+=1){if(d1[i]!==d2[i]){return false}}return true};NDArray.prototype.equidimensional=function(x){var s1=this.shape;var s2=x.shape;if(!s1.every(function(dim,i){return dim===s2[i]})){throw new Error("shapes "+s1+" and "+s2+" do not match")}};NDArray.prototype.equilateral=function(x){var l1=this.length;var l2=x.length;if(l1!==l2){throw new Error("lengths "+l1+" and "+l2+" do not match")}};NDArray.prototype.exp=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=exp(this.data[i])}return this};NDArray.prototype.expm1=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=expm1(this.data[i])}return this};NDArray.prototype.fill=function(value){if(value===void 0){value=0}var _a=this,data=_a.data,length=_a.length;var i;for(i=0;i<length;i+=1){data[i]=value instanceof Function?value(i):value}return this};NDArray.prototype.floor=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=floor(this.data[i])}return this};NDArray.prototype.fround=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=fround(this.data[i])}return this};NDArray.prototype.log=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=log(this.data[i])}return this};NDArray.prototype.log10=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=log10(this.data[i])}return this};NDArray.prototype.log1p=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=log1p(this.data[i])}return this};NDArray.prototype.log2=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=log2(this.data[i])}return this};NDArray.prototype.magnitude=function(){var length=this.length;if(length===0){return 0}var data=this.data;try{return nblas.nrm2(data)}catch(err){var result=0;var i=void 0;for(i=0;i<length;i+=1){result+=data[i]*data[i]}return Math.sqrt(result)}};NDArray.prototype.max=function(){var data=this.data;try{return data[nblas.iamax(data)]}catch(err){var length_1=this.length;var result=Number.NEGATIVE_INFINITY;var i=void 0;for(i=0;i<length_1;i+=1){result=result<data[i]?data[i]:result}return result}};NDArray.prototype.min=function(){var _a=this,data=_a.data,length=_a.length;var result=Number.POSITIVE_INFINITY;var i;for(i=0;i<length;i+=1){result=result<data[i]?result:data[i]}return result};NDArray.prototype.pow=function(exponent){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=pow(this.data[i],exponent)}return this};NDArray.prototype.product=function(x){this.equilateral(x);this.equidimensional(x);var _a=this,d1=_a.data,l1=_a.length;var d2=x.data;var i;for(i=0;i<l1;i+=1){d1[i]*=d2[i]}return this};NDArray.prototype.reshape=function(s){var length=this.length;if(s.reduce(function(sum,dim){return sum*dim},1)!==length){throw new Error("shape "+util_1.shape+" does not match length "+length)}this.shape=s;return this};NDArray.prototype.round=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=round(this.data[i])}return this};NDArray.prototype.scale=function(scalar){var data=this.data;try{nblas.scal(data,scalar)}catch(err){var length_2=this.length;var i=void 0;for(i=0;i<length_2;i+=1){data[i]*=scalar}}return this};NDArray.prototype.sign=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=sign(this.data[i])}return this};NDArray.prototype.sin=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=sin(this.data[i])}return this};NDArray.prototype.sinh=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=sinh(this.data[i])}return this};NDArray.prototype.sqrt=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=sqrt(this.data[i])}return this};NDArray.prototype.subtract=function(x){return this.add(x,-1)};NDArray.prototype.tan=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=tan(this.data[i])}return this};NDArray.prototype.tanh=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=tanh(this.data[i])}return this};NDArray.prototype.trunc=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=trunc(this.data[i])}return this};return NDArray}();exports.NDArray=NDArray;try{window.NDArray=NDArray}catch(error){}},{"./util":24,nblas:13}],22:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var NDArray_1=require("./NDArray");var Vector=function(_super){__extends(Vector,_super);function Vector(data){return _super.call(this,typeof data==="number"?new Float32Array(data):data)||this}Vector.add=function(a,b){return a.copy().add(b)};Vector.angle=function(a,b){return a.angle(b)};Vector.binOp=function(a,b,op){return a.copy().binOp(b,op)};Vector.combine=function(a,b){return a.copy().combine(b)};Vector.dot=function(a,b){return a.dot(b)};Vector.equals=function(a,b){return a.equals(b)};Vector.fill=function(count,value,type){if(value===void 0){value=0}if(type===void 0){type=Float32Array}if(count<0){throw new Error("invalid size")}var data=new type(count);return new Vector(data).fill(value)};Vector.normalize=function(vector){return vector.copy().normalize()};Vector.ones=function(count,type){if(type===void 0){type=Float32Array}return Vector.fill(count,1,type)};Vector.project=function(a,b){return a.project(b.copy())};Vector.random=function(count,min,max,type){if(min===void 0){min=0}if(max===void 0){max=1}if(type===void 0){type=Float32Array}return Vector.fill(count,min,type).map(function(value){return value+Math.random()*(max-min)})};Vector.range=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var type=Float32Array;var backwards=false;var start;var step;var end;if(typeof args[args.length-1]==="function"){type=args.pop()}switch(args.length){case 2:end=args.pop();step=1;start=args.pop();break;case 3:end=args.pop();step=args.pop();start=args.pop();break;default:throw new Error("invalid range")}if(end-start<0){var copy=end;end=start;start=copy;backwards=true}if(step>end-start){throw new Error("invalid range")}var data=new type(Math.ceil((end-start)/step));var i=start;var j=0;if(backwards){for(;i<end;i+=step,j+=1){data[j]=end-i+start}}else{for(;i<end;i+=step,j+=1){data[j]=i}}return new Vector(data)};Vector.scale=function(vector,scalar){return vector.copy().scale(scalar)};Vector.subtract=function(a,b){return a.copy().subtract(b)};Vector.zeros=function(count,type){if(type===void 0){type=Float32Array}return Vector.fill(count,0,type)};Vector.prototype.angle=function(vector){return Math.acos(this.dot(vector)/this.magnitude()/vector.magnitude())};Vector.prototype.binOp=function(vector,op){var l1=this.length;var l2=vector.length;if(l1!==l2){throw new Error("sizes do not match!")}var i;for(i=0;i<l1;i+=1){this.data[i]=op(this.data[i],vector.data[i],i)}return this};Vector.prototype.check=function(index){if(!isFinite(index)||index<0||index>this.length-1){throw new Error("index out of bounds")}};Vector.prototype.combine=function(vector){var l1=this.length;var l2=vector.length;if(l2===0){return this}if(l1===0){this.data=new vector.type(vector.data);this.length=l2;this.type=vector.type;return this}var d1=this.data;var d2=vector.data;var data=new this.type(l1+l2);data.set(d1);data.set(d2,l1);this.data=data;this.length=l1+l2;this.shape=[l1+l2];return this};Vector.prototype.cross=function(vector){if(this.length!==3||vector.length!==3){throw new Error("cross(...) : vectors must have three components.")}var c1=this.y*vector.z-this.z*vector.y;var c2=this.z*vector.x-this.x*vector.z;var c3=this.x*vector.y-this.y*vector.x;return new Vector([c1,c2,c3])};Vector.prototype.each=function(callback){var i;for(i=0;i<this.length;i+=1){callback.call(this,this.data[i],i,this.data)}return this};Vector.prototype.get=function(index){this.check(index);return this.data[index]};Vector.prototype.map=function(callback){var l=this.length;var mapped=this.copy();var data=mapped.data;var i;for(i=0;i<l;i+=1){data[i]=callback.call(mapped,data[i],i,data)}return mapped};Vector.prototype.normalize=function(){return this.scale(1/this.magnitude())};Vector.prototype.project=function(vector){return vector.scale(this.dot(vector)/vector.dot(vector))};Vector.prototype.push=function(value){return this.combine(new Vector([value]))};Vector.prototype.reduce=function(callback,initialValue){var l=this.length;if(l===0&&initialValue===undefined){throw new Error("Reduce of empty matrix with no initial value.")}var i;var value;if(initialValue===undefined){value=this.data[0];i=1}else{value=initialValue;i=0}for(;i<l;i+=1){value=callback.call(this,value,this.data[i],i,this.data)}return value};Vector.prototype.set=function(index,value){this.check(index);this.data[index]=value;return this};Object.defineProperty(Vector.prototype,"x",{get:function(){return this.get(0)},set:function(value){this.set(0,value)},enumerable:true,configurable:true});Object.defineProperty(Vector.prototype,"y",{get:function(){return this.get(1)},set:function(value){this.set(1,value)},enumerable:true,configurable:true});Object.defineProperty(Vector.prototype,"z",{get:function(){return this.get(2)},set:function(value){this.set(2,value)},enumerable:true,configurable:true});Object.defineProperty(Vector.prototype,"w",{get:function(){return this.get(3)},set:function(value){this.set(3,value)},enumerable:true,configurable:true});Vector.prototype.toArray=function(){return[].slice.call(this.data)};Vector.prototype.toString=function(){var l=this.length;var result=["["];var i=0;if(i<l){result.push(String(this.data[i]));i+=1}while(i<l){result.push(", "+this.data[i]);i+=1}result.push("]");return result.join("")};return Vector}(NDArray_1.NDArray);exports.Vector=Vector;try{window.Vector=Vector}catch(error){}},{"./NDArray":21}],23:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Vector_1=require("./Vector");exports.Vector=Vector_1.Vector;var Matrix_1=require("./Matrix");exports.Matrix=Matrix_1.Matrix;var NDArray_1=require("./NDArray");exports.NDArray=NDArray_1.NDArray},{"./Matrix":20,"./NDArray":21,"./Vector":22}],24:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.flatten=function(input){return input.reduce(function(acc,next){return acc.concat(Array.isArray(next)?exports.flatten(next):next)},[])};exports.shape=function(input){return Array.isArray(input)?[input.length].concat(exports.shape(input[0])):[]};exports.type=function(input){switch(input.constructor.name){case"Int8Array":return Int8Array;case"Uint8Array":return Uint8Array;case"Int16Array":return Int16Array;case"Uint16Array":return Uint16Array;case"Int32Array":return Int32Array;case"Uint32Array":return Uint32Array;case"Uint8ClampedArray":return Uint8ClampedArray;case"Float64Array":return Float64Array;default:return Float32Array}};exports.isTypedArray=function(input){return!!(input&&input.buffer instanceof ArrayBuffer&&input.BYTES_PER_ELEMENT)}},{}],25:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Bezier=void 0;var _Renderer=require("./Renderer");var _PrimitiveComponent2=require("./PrimitiveComponent");var _vectorious=require("vectorious");function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function set(target,property,value,receiver){if(typeof Reflect!=="undefined"&&Reflect.set){set=Reflect.set}else{set=function set(target,property,value,receiver){var base=_superPropBase(target,property);var desc;if(base){desc=Object.getOwnPropertyDescriptor(base,property);if(desc.set){desc.set.call(receiver,value);return true}else if(!desc.writable){return false}}desc=Object.getOwnPropertyDescriptor(receiver,property);if(desc){if(!desc.writable){return false}desc.value=value;Object.defineProperty(receiver,property,desc)}else{_defineProperty(receiver,property,value)}return true}}return set(target,property,value,receiver)}function _set(target,property,value,receiver,isStrict){var s=set(target,property,value,receiver||target);if(!s&&isStrict){throw new Error("failed to set property")}return value}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _cubicBezier(start,c1,c2,end,t){return start*(1-t)*(1-t)*(1-t)+3*c1*t*(1-t)*(1-t)+3*c2*t*t*(1-t)+end*t*t*t}function _getExtremes(start,c1,c2,end){var a=3*end-9*c2+9*c1-3*start;var b=6*c2-12*c1+6*start;var c=3*c1-3*start;var solutions=[];var localExtrema=[];var disc=b*b-4*a*c;if(disc>=0){if(!Math.abs(a)>0&&Math.abs(b)>0){solutions.push(-c/b)}else if(Math.abs(a)>0){solutions.push((-b+Math.sqrt(disc))/(2*a));solutions.push((-b-Math.sqrt(disc))/(2*a))}else{throw new Error("no solutions!?!?!")}for(var _i=0,_solutions=solutions;_i<_solutions.length;_i++){var t=_solutions[_i];if(0<=t&&t<=1){localExtrema.push(_cubicBezier(start,c1,c2,end,t))}}}localExtrema.push(start,end);return localExtrema}var Bezier=function(_PrimitiveComponent){_inherits(Bezier,_PrimitiveComponent);function Bezier(options){var _this;_classCallCheck(this,Bezier);_this=_possibleConstructorReturn(this,_getPrototypeOf(Bezier).call(this,options));var start=new _vectorious.Vector([options.start.x,options.start.y]);var end=new _vectorious.Vector([options.end.x,options.end.y]);var control1=new _vectorious.Vector([options.control1.x,options.control1.y]);var control2=new _vectorious.Vector([options.control2.x,options.control2.y]);_this._boundingBox=null;_this._boundingBoxNeedsUpdate=true;var xExtrema=_getExtremes(start.x,control1.x,control2,end.x);var yExtrema=_getExtremes(start.y,control1.y,control2.y,end.y);_set(_getPrototypeOf(Bezier.prototype),"d",new _vectorious.Vector([Math.min.apply(null,xExtrema),Math.min.apply(null,yExtrema)]),_assertThisInitialized(_this),true);_this._normalizationVector=_this.d;_this._start=_vectorious.Vector.subtract(start,_this._normalizationVector);_this._end=_vectorious.Vector.subtract(end,_this._normalizationVector);_this._control1=_vectorious.Vector.subtract(control1,_this._normalizationVector);_this._control2=_vectorious.Vector.subtract(control2,_this._normalizationVector);return _this}_createClass(Bezier,[{key:"render",value:function render(){_Renderer.Renderer.drawBezier(this._start,this._end,this._control1,this._control2,this._prerenderingContext,this.style)}},{key:"boundingBox",get:function get(){var lineWidth=this.style.lineWidth;var offset=this.offset;var start=_vectorious.Vector.add(this._start,this.offset);var control1=_vectorious.Vector.add(this._control1,this.offset);var control2=_vectorious.Vector.add(this._control2,this.offset);var end=_vectorious.Vector.add(this._end,this.offset);var xExtrema=_getExtremes(start.x,control1.x,control2,end.x);var yExtrema=_getExtremes(start.y,control1.y,control2.y,end.y);this._boundingBox={top:Math.min.apply(null,yExtrema)-lineWidth,right:Math.max.apply(null,xExtrema)+lineWidth,bottom:Math.max.apply(null,yExtrema)+lineWidth,left:Math.min.apply(null,xExtrema)-lineWidth};this._boundingBoxNeedsUpdate=false;return this._boundingBox}}]);return Bezier}(_PrimitiveComponent2.PrimitiveComponent);exports.Bezier=Bezier},{"./PrimitiveComponent":32,"./Renderer":34,vectorious:23}],26:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.init=init;Object.defineProperty(exports,"DEFAULTS",{enumerable:true,get:function get(){return _Renderer.DEFAULTS}});Object.defineProperty(exports,"Renderer",{enumerable:true,get:function get(){return _Renderer.Renderer}});Object.defineProperty(exports,"Composition",{enumerable:true,get:function get(){return _Composition.Composition}});Object.defineProperty(exports,"PrimitiveComponent",{enumerable:true,get:function get(){return _PrimitiveComponent.PrimitiveComponent}});Object.defineProperty(exports,"Circle",{enumerable:true,get:function get(){return _Circle.Circle}});Object.defineProperty(exports,"Ellipse",{enumerable:true,get:function get(){return _Ellipse.Ellipse}});Object.defineProperty(exports,"Rectangle",{enumerable:true,get:function get(){return _Rectangle.Rectangle}});Object.defineProperty(exports,"Line",{enumerable:true,get:function get(){return _Line.Line}});Object.defineProperty(exports,"VectorPath",{enumerable:true,get:function get(){return _VectorPath.VectorPath}});Object.defineProperty(exports,"Bezier",{enumerable:true,get:function get(){return _Bezier.Bezier}});Object.defineProperty(exports,"Image",{enumerable:true,get:function get(){return _Image.Image}});Object.defineProperty(exports,"Text",{enumerable:true,get:function get(){return _Text.Text}});exports.EVENTS=exports.EPSILON=void 0;var _Renderer=require("./Renderer");var _Composition=require("./Composition");var _PrimitiveComponent=require("./PrimitiveComponent");var _Circle=require("./Circle");var _Ellipse=require("./Ellipse");var _Rectangle=require("./Rectangle");var _Line=require("./Line");var _VectorPath=require("./VectorPath");var _Bezier=require("./Bezier");var _Image=require("./Image");var _Text=require("./Text");var _microMvc=require("micro-mvc");function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var DEFAULT_TARGET_FPS=1e3/60;var EPSILON=Number.EPSILON;exports.EPSILON=EPSILON;var EVENTS={MOUSEUP:"mouseup",MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",MOUSEOUT:"mouseout",CLICK:"click",KEYDOWN:"keydown",KEYUP:"keyup",KEYPRESS:"keypress"};exports.EVENTS=EVENTS;var CanvasCompositor=function(_EventEmitter){_inherits(CanvasCompositor,_EventEmitter);function CanvasCompositor(canvas){var _this;_classCallCheck(this,CanvasCompositor);_this=_possibleConstructorReturn(this,_getPrototypeOf(CanvasCompositor).call(this));_this._canvas=canvas;_this._context=_this._canvas.getContext("2d");var style=window.getComputedStyle(_this._canvas);_this._mouseX=null;_this._mouseY=null;var borderLeft=style.getPropertyValue("border-left")?parseFloat(style.getPropertyValue("border-left")):0;var paddingLeft=style.getPropertyValue("padding-left")?parseFloat(style.getPropertyValue("padding-left")):0;_this._leftPadding=borderLeft+paddingLeft;var borderTop=style.getPropertyValue("border-top")?parseFloat(style.getPropertyValue("border-top")):0;var paddingTop=style.getPropertyValue("padding-top")?parseFloat(style.getPropertyValue("padding-top")):0;_this._topPadding=borderTop+paddingTop;_this._currentTime=0;_this._lastFrameTimestamp=0;_this._lastRenderTime=0;_this._targetObject=null;_this._scene=new _Composition.Composition(_this.canvas);_this._bindEvents();_this._animationLoop();_this._framerate=0;return _this}_createClass(CanvasCompositor,[{key:"_animationLoop",value:function _animationLoop(){window.requestAnimationFrame(this._animationLoop.bind(this));this._currentTime=+new Date;if(this.scene.needsDraw){this._lastRenderTime=+new Date;_Renderer.Renderer.clearRect(0,0,this._canvas.width,this._canvas.height,this._context);this.scene.draw(this._context)}this._framerate=parseInt(1e3/(this._currentTime-this._lastFrameTimestamp));this._lastFrameTimestamp=+new Date}},{key:"_bindEvents",value:function _bindEvents(){var _cc=this;this._canvas.addEventListener("mousedown",function(e){_cc.dispatchEvent(e)});this._canvas.addEventListener("mousemove",function(e){_cc.dispatchEvent(e)});this._canvas.addEventListener("mouseup",function(e){_cc.dispatchEvent(e)});this._canvas.addEventListener("mouseout",function(e){_cc.dispatchEvent(e)});this._canvas.addEventListener("click",function(e){_cc.dispatchEvent(e)});this.addEventListener("mousedown",this._handleMouseDown);this.addEventListener("mousemove",this._handleMouseMove);this.addEventListener("mouseup",this._handleMouseUp);this.addEventListener("mouseout",this._handleMouseOut);this.addEventListener("click",this._handleClick)}},{key:"_handleMouseDown",value:function _handleMouseDown(e){e.preventDefault();var x=e.offsetX-this._leftPadding;var y=e.offsetY-this._topPadding;e.canvasX=x;e.canvasY=y;var clickedObject=this.scene.childAt(x,y);if(clickedObject){clickedObject.dispatchEvent(e)}}},{key:"_handleMouseUp",value:function _handleMouseUp(e){e.preventDefault();var x=e.offsetX-this._leftPadding;var y=e.offsetY-this._topPadding;e.canvasX=x;e.canvasY=y;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.scene.children[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var c=_step.value;c.dispatchEvent(e)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}var clickedObject=this.scene.childAt(x,y);if(clickedObject){clickedObject.dispatchEvent(e)}}},{key:"_handleMouseMove",value:function _handleMouseMove(e){e.preventDefault();this._mouseX=e.offsetX-this._leftPadding;this._mouseY=e.offsetY-this._topPadding;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.scene.children[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var c=_step2.value;c.dispatchEvent(e)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]!=null){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"_handleClick",value:function _handleClick(e){e.preventDefault();var x=e.offsetX-this._leftPadding;var y=e.offsetY-this._topPadding;e.canvasX=x;e.canvasY=y;var clickedObject=this.scene.childAt(x,y);if(clickedObject){clickedObject.dispatchEvent(e)}}},{key:"_handleMouseOut",value:function _handleMouseOut(e){e.preventDefault();var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.scene.children[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var c=_step3.value;c.dispatchEvent(e)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]!=null){_iterator3["return"]()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}},{key:"framerate",get:function get(){return this._framerate}},{key:"targetObject",get:function get(){return this._targetObject},set:function set(val){this._targetObject=val}},{key:"scene",get:function get(){return this._scene}},{key:"mouseX",get:function get(){return this._mouseX}},{key:"mouseY",get:function get(){return this._mouseY}}]);return CanvasCompositor}(_microMvc.EventEmitter);function init(canvas){return new CanvasCompositor(canvas)}},{"./Bezier":25,"./Circle":27,"./Composition":28,"./Ellipse":29,"./Image":30,"./Line":31,"./PrimitiveComponent":32,"./Rectangle":33,"./Renderer":34,"./Text":35,"./VectorPath":36,"micro-mvc":17}],27:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Circle=void 0;var _Renderer=require("./Renderer");var _PrimitiveComponent2=require("./PrimitiveComponent");function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var Circle=function(_PrimitiveComponent){_inherits(Circle,_PrimitiveComponent);function Circle(options){var _this;_classCallCheck(this,Circle);_this=_possibleConstructorReturn(this,_getPrototypeOf(Circle).call(this,options));_this.radius=options.radius||0;return _this}_createClass(Circle,[{key:"render",value:function render(){var scale=this.compoundScale;var lineWidth=this.style.lineWidth;_Renderer.Renderer.drawCircle(this.radius*scale.scaleWidth+lineWidth,this.radius*scale.scaleHeight+lineWidth,this.radius*scale.scaleWidth,this._prerenderingContext,this.style)}},{key:"pointIsInObject",value:function pointIsInObject(x,y){var offset=this.offset;var a=x-offset.x;var b=y-offset.y;var c=this.radius;return a*a+b*b<=c*c}},{key:"boundingBox",get:function get(){var offset=this.offset;var scale=this.compoundScale;return{top:offset.y-(this.radius*scale.scaleHeight+this.style.lineWidth),left:offset.x-(this.radius*scale.scaleWidth+this.style.lineWidth),bottom:offset.y+this.radius*scale.scaleHeight+this.style.lineWidth,right:offset.x+this.radius*scale.scaleWidth+this.style.lineWidth}}}]);return Circle}(_PrimitiveComponent2.PrimitiveComponent);exports.Circle=Circle},{"./PrimitiveComponent":32,"./Renderer":34}],28:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Composition=void 0;var _PrimitiveComponent2=require("./PrimitiveComponent");function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function set(target,property,value,receiver){if(typeof Reflect!=="undefined"&&Reflect.set){set=Reflect.set}else{set=function set(target,property,value,receiver){var base=_superPropBase(target,property);var desc;if(base){desc=Object.getOwnPropertyDescriptor(base,property);if(desc.set){desc.set.call(receiver,value);return true}else if(!desc.writable){return false}}desc=Object.getOwnPropertyDescriptor(receiver,property);if(desc){if(!desc.writable){return false}desc.value=value;Object.defineProperty(receiver,property,desc)}else{_defineProperty(receiver,property,value)}return true}}return set(target,property,value,receiver)}function _set(target,property,value,receiver,isStrict){var s=set(target,property,value,receiver||target);if(!s&&isStrict){throw new Error("failed to set property")}return value}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var Composition=function(_PrimitiveComponent){_inherits(Composition,_PrimitiveComponent);function Composition(options){var _this;_classCallCheck(this,Composition);_this=_possibleConstructorReturn(this,_getPrototypeOf(Composition).call(this,options));options=options||{};_this._children=options.children||[];return _this}_createClass(Composition,[{key:"childrenAt",value:function childrenAt(x,y){return this.children.filter(function(c){return c.PointIsInObject(x,y)})}},{key:"childAt",value:function childAt(x,y){for(var c=this.children.length-1;c>=0;c--){if(this.children[c].pointIsInObject(x,y)){return this.children[c]}}}},{key:"addChild",value:function addChild(child){child.parent=this;this.children.push(child);_set(_getPrototypeOf(Composition.prototype),"needsRender",true,this,true);_set(_getPrototypeOf(Composition.prototype),"needsDraw",true,this,true)}},{key:"addChildren",value:function addChildren(children){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=children[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var c=_step.value;this.addChild(c)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"removeChild",value:function removeChild(child){if(child){var index=this.children.indexOf(child);if(index>=0){_set(_getPrototypeOf(Composition.prototype),"needsRender",true,this,true);_set(_getPrototypeOf(Composition.prototype),"needsDraw",true,this,true);return this.children.splice(index,1)}}}},{key:"render",value:function render(){var boundingBox=this.boundingBox;var offset={top:-boundingBox.top,left:-boundingBox.left,bottom:-boundingBox.bottom,right:-boundingBox.right};var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.children[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var c=_step2.value;c.draw(this._prerenderingContext,offset)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]!=null){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"children",get:function get(){return this._children}},{key:"boundingBox",get:function get(){var top=Infinity,left=Infinity,bottom=-Infinity,right=-Infinity;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.children[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var c=_step3.value;var boundingBox=c.boundingBox;top=Math.min(boundingBox.top,top);left=Math.min(boundingBox.left,left);bottom=Math.max(boundingBox.bottom,bottom);right=Math.max(boundingBox.right,right)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]!=null){_iterator3["return"]()}}finally{if(_didIteratorError3){throw _iteratorError3}}}return{top:top,left:left,bottom:bottom,right:right}}}]);return Composition}(_PrimitiveComponent2.PrimitiveComponent);exports.Composition=Composition},{"./PrimitiveComponent":32}],29:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Ellipse=void 0;var _Renderer=require("./Renderer");var _PrimitiveComponent2=require("./PrimitiveComponent");function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var Ellipse=function(_PrimitiveComponent){_inherits(Ellipse,_PrimitiveComponent);function Ellipse(options){var _this;_classCallCheck(this,Ellipse);_this=_possibleConstructorReturn(this,_getPrototypeOf(Ellipse).call(this,options));_this.radius=options.radius||0;_this.minorRadius=options.minorRadius||_this.radius||0;return _this}_createClass(Ellipse,[{key:"render",value:function render(){var scale=this.compoundScale;var lineWidth=this.style.lineWidth;_Renderer.Renderer.drawEllipse(this.radius*scale.scaleWidth+lineWidth,this.minorRadius*scale.scaleHeight+lineWidth,this.radius*scale.scaleWidth,this.minorRadius*scale.scaleHeight,this._prerenderingContext,this.style)}},{key:"pointIsInObject",value:function pointIsInObject(x,y){var scale=this.compoundScale;var offset=this.offset;var a=x-offset.x;var b=y-offset.y;var c1=this.radius*scale.scaleWidth;var c2=this.minorRadius*scale.scaleHeight;return a*a/(c1*c1)+b*b/(c2*c2)<=1}},{key:"boundingBox",get:function get(){var offset=this.offset;var scale=this.compoundScale;var lineWidth=this.style.lineWidth;return{top:offset.y-(this.minorRadius*scale.scaleHeight+lineWidth),left:offset.x-(this.radius*scale.scaleWidth+lineWidth),bottom:offset.y+this.minorRadius*scale.scaleHeight+lineWidth,right:offset.x+this.radius*scale.scaleWidth+lineWidth}}}]);return Ellipse}(_PrimitiveComponent2.PrimitiveComponent);exports.Ellipse=Ellipse},{"./PrimitiveComponent":32,"./Renderer":34}],30:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Image=void 0;var _Renderer=require("./Renderer");var _PrimitiveComponent2=require("./PrimitiveComponent");function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var Image=function(_PrimitiveComponent){_inherits(Image,_PrimitiveComponent);function Image(options){var _this;_classCallCheck(this,Image);_this=_possibleConstructorReturn(this,_getPrototypeOf(Image).call(this,options));_this.unscaledImage=options.image;return _this}_createClass(Image,[{key:"render",value:function render(){var scale=this.compoundScale;var image=new window.Image;image.src=this.unscaledImage.src;image.width=this.unscaledImage.width*scale.scaleWidth;image.height=this.unscaledImage.height*scale.scaleHeight;_Renderer.Renderer.drawImage(0,0,image,this._prerenderingContext,this.style)}},{key:"boundingBox",get:function get(){var compoundScale=this.compoundScale;var offset=this.offset;return{top:offset.y,left:offset.x,bottom:offset.y+compoundScale.scaleHeight*this.unscaledImage.height,right:offset.x+compoundScale.scaleWidth*this.unscaledImage.width}}}]);return Image}(_PrimitiveComponent2.PrimitiveComponent);exports.Image=Image},{"./PrimitiveComponent":32,"./Renderer":34}],31:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Line=void 0;var _vectorious=require("vectorious");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var Line=function(){function Line(anchor,direction){_classCallCheck(this,Line);this.p1=anchor;this.direction=direction;this.p2=_vectorious.Vector.add(this.p1,this.direction)}_createClass(Line,[{key:"intersectionWith",value:function intersectionWith(l){return Line.intersection(this,l)}}],[{key:"intersection",value:function intersection(l1,l2){var x1=l1.p1.x,x2=l1.p2.x,x3=l2.p1.x,x4=l2.p2.x;var y1=l1.p1.y,y2=l1.p2.y,y3=l2.p1.y,y4=l2.p2.y;var denominator=(x1-x2)*(y3-y4)-(y1-y2)*(x3-x4);if(denominator===0){return null}var xNumerator=(x1*y2-y1*x2)*(x3-x4)-(x1-x2)*(x3*y4-y3*x4);var yNumerator=(x1*y2-y1*x2)*(y3-y4)-(y1-y2)*(x3*y4-y3*x4);return new _vectorious.Vector([xNumerator/denominator,yNumerator/denominator])}}]);return Line}();exports.Line=Line},{vectorious:23}],32:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.PrimitiveComponent=void 0;var _vectorious=require("vectorious");var _Renderer=require("./Renderer");var _microMvc=require("micro-mvc");function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var PrimitiveComponent=function(_EventEmitter){_inherits(PrimitiveComponent,_EventEmitter);function PrimitiveComponent(options){var _this;_classCallCheck(this,PrimitiveComponent);_this=_possibleConstructorReturn(this,_getPrototypeOf(PrimitiveComponent).call(this));options=options||{};_this._flags={};_this._flags.DEBUG=options.debug||false;_this._needsDraw=true;_this._needsRender=true;_this._scaleWidth=1;_this._scaleHeight=1;_this._d=new _vectorious.Vector([options.x||0,options.y||0]);_this.style=Object.assign({},_Renderer.DEFAULTS,options.style);_this._prerenderingCanvas=document.createElement("canvas");_this._prerenderingContext=_this._prerenderingCanvas.getContext("2d");_this._parent=options.parent||null;return _this}_createClass(PrimitiveComponent,[{key:"draw",value:function draw(context,offset){var boundingBox=this.boundingBox;this.needsDraw=false;if(this.needsRender&&this.render){delete this._prerenderingCanvas;delete this._prerenderingContext;this._prerenderingCanvas=document.createElement("canvas");this._prerenderingContext=this._prerenderingCanvas.getContext("2d");this._prerenderingCanvas.width=boundingBox.right-boundingBox.left;this._prerenderingCanvas.height=boundingBox.bottom-boundingBox.top;this.render();this.needsRender=false}if(this._flags.DEBUG){this._prerenderingContext.beginPath();this._prerenderingContext.setLineDash([5,15]);this._prerenderingContext.lineWidth=2;this._prerenderingContext.strokeStyle="#FF0000";this._prerenderingContext.strokeStyle="#FF0000";this._prerenderingContext.strokeRect(0,0,this._prerenderingCanvas.width,this._prerenderingCanvas.height);this._prerenderingContext.closePath()}var x=boundingBox.left+(offset&&offset.left?offset.left:0);var y=boundingBox.top+(offset&&offset.top?offset.top:0);_Renderer.Renderer.drawImage(x,y,this._prerenderingCanvas,context,this.style)}},{key:"render",value:function render(){}},{key:"pointIsInBoundingBox",value:function pointIsInBoundingBox(x,y){var boundingBox=this.boundingBox;return x>boundingBox.left&&y>boundingBox.top&&x<boundingBox.right&&y<boundingBox.bottom}},{key:"pointIsInObject",value:function pointIsInObject(x,y){return this.pointIsInBoundingBox(x,y)}},{key:"moveToFront",value:function moveToFront(){if(this.parent){var index=this.parent.children.indexOf(this);if(index>=0){this.parent.children.splice(index,1);this.parent.children.splice(this.parent.children.length,0,this);this.needsDraw=true}}}},{key:"moveToBack",value:function moveToBack(){if(this.parent){var index=this.parent.children.indexOf(this);if(index>=0){this.parent.children.splice(index,1);this.parent.children.splice(0,0,this);this.needsDraw=true}}}},{key:"moveForward",value:function moveForward(){if(this.parent){var index=this.parent.children.indexOf(this);if(index>=0&&index<this.parent.children.length-1){this.parent.children.splice(index,1);this.parent.children.splice(index+1,0,this);this.parent.UpdateChildrenLists();this.needsRender=true;this.needsDraw=true}}}},{key:"moveBackward",value:function moveBackward(){if(this.parent){var index=this.parent.children.indexOf(this);if(index>0){this.parent.children.splice(index,1);this.parent.children.splice(index-1,0,this);this.parent.UpdateChildrenLists();this.needsRender=true;this.needsDraw=true}}}},{key:"offset",get:function get(){return this.parent?_vectorious.Vector.add(this.d,this.parent.offset):this.d}},{key:"needsDraw",get:function get(){return this._needsDraw},set:function set(val){if(this.parent&&val){this.parent.needsDraw=val;this.parent.needsRender=true}this._needsDraw=val}},{key:"needsRender",get:function get(){return this._needsRender},set:function set(val){if(this.parent&&val){this.parent.needsRender=val}this._needsRender=val}},{key:"scaleWidth",get:function get(){return this._scaleWidth},set:function set(val){this._scaleWidth=val;this.needsRender=true;this.needsDraw=true;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.children[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var c=_step.value;c.needsRender=true;c.needsDraw=true}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"scaleHeight",get:function get(){return this._scaleHeight},set:function set(val){this._scaleHeight=val;this.needsRender=true;this.needsDraw=true;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.children[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var c=_step2.value;c.needsRender=true;c.needsDraw=true}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]!=null){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}},{key:"scale",get:function get(){return{scaleWidth:this.scaleWidth,scaleHeight:this.scaleHeight}},set:function set(val){this.scaleHeight=val;this.scaleWidth=val}},{key:"compoundScale",get:function get(){return{scaleWidth:this.parent?this.scaleWidth*this.parent.compoundScale.scaleWidth:this.scaleWidth,scaleHeight:this.parent?this.scaleHeight*this.parent.compoundScale.scaleHeight:this.scaleHeight}}},{key:"d",get:function get(){return this._d},set:function set(val){this._d=val}},{key:"parent",get:function get(){return this._parent},set:function set(val){this._parent=val}}]);return PrimitiveComponent}(_microMvc.EventEmitter);exports.PrimitiveComponent=PrimitiveComponent},{"./Renderer":34,"micro-mvc":17,vectorious:23}],33:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Rectangle=void 0;var _Renderer=require("./Renderer");var _PrimitiveComponent2=require("./PrimitiveComponent");function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var Rectangle=function(_PrimitiveComponent){_inherits(Rectangle,_PrimitiveComponent);function Rectangle(options){var _this;_classCallCheck(this,Rectangle);_this=_possibleConstructorReturn(this,_getPrototypeOf(Rectangle).call(this,options));_this.width=options.width||0;_this.height=options.height||0;return _this}_createClass(Rectangle,[{key:"render",value:function render(){var compoundScale=this.compoundScale;_Renderer.Renderer.drawRectangle(this.style.lineWidth,this.style.lineWidth,this.width*compoundScale.scaleWidth,this.height*compoundScale.scaleHeight,this._prerenderingContext,this.style)}},{key:"boundingBox",get:function get(){var offset=this.offset;var compoundScale=this.compoundScale;return{top:offset.y-this.style.lineWidth,left:offset.x-this.style.lineWidth,bottom:offset.y+compoundScale.scaleHeight*this.height+this.style.lineWidth,right:offset.x+compoundScale.scaleWidth*this.width+this.style.lineWidth}}}]);return Rectangle}(_PrimitiveComponent2.PrimitiveComponent);exports.Rectangle=Rectangle},{"./PrimitiveComponent":32,"./Renderer":34}],34:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Renderer=exports.DEFAULTS=void 0;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var DEFAULTS={fillStyle:"black",strokeStyle:"black",lineCap:"round",lineWidth:1,lineJoin:"round",miterLimit:10,font:"10px sans-serif",textAlign:"start",textBaseline:"alphabetic",lineDash:[]};exports.DEFAULTS=DEFAULTS;var Renderer=function(){function Renderer(){_classCallCheck(this,Renderer)}_createClass(Renderer,null,[{key:"clearRect",value:function clearRect(x,y,width,height,context){context.clearRect(x,y,width,height)}},{key:"drawPath",value:function drawPath(vertices,context,style){Object.assign(context,style);context.beginPath();context.moveTo(vertices[0].x,vertices[0].y);for(var v=1;v<vertices.length;v++){context.lineTo(vertices[v].x,vertices[v].y)}context.setLineDash(style.lineDash);context.stroke()}},{key:"drawPolygon",value:function drawPolygon(vertices,context,style){Object.assign(context,style);context.beginPath();context.moveTo(vertices[0].x,vertices[0].y);for(var v=1;v<vertices.length;v++){context.lineTo(vertices[v].x,vertices[v].y)}context.closePath();context.setLineDash(style.lineDash);context.stroke()}},{key:"drawBezier",value:function drawBezier(start,end,c1,c2,context,style){Object.assign(context,style);context.beginPath();context.moveTo(start.x,start.y);context.bezierCurveTo(c1.x,c1.y,c2.x,c2.y,end.x,end.y);context.setLineDash(style.lineDash);context.stroke();context.closePath()}},{key:"drawRectangle",value:function drawRectangle(x,y,width,height,context,style){Object.assign(context,style);context.rect(x,y,width,height);context.fill();context.setLineDash(style.lineDash);context.stroke()}},{key:"drawEllipse",value:function drawEllipse(x,y,radius,minorRadius,context,style){Object.assign(context,style);context.ellipse(x,y,radius,minorRadius,0,0,2*Math.PI);context.fill();context.setLineDash(style.lineDash);context.stroke()}},{key:"drawCircle",value:function drawCircle(x,y,radius,context,style){Object.assign(context,style);context.arc(x,y,radius,0,2*Math.PI);context.fill();context.setLineDash(style.lineDash);context.stroke()}},{key:"drawText",value:function drawText(x,y,text,context,style){Object.assign(context,style);context.fillText(text,x,y)}},{key:"drawImage",value:function drawImage(x,y,image,context,style){Object.assign(context,style);if(image.width>0&&image.height>0){context.drawImage(image,x,y,image.width,image.height)}}},{key:"measureText",value:function measureText(text,context,style){Object.assign(context,style);return context.measureText(text)}}]);return Renderer}();exports.Renderer=Renderer},{}],35:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Text=void 0;var _Renderer=require("./Renderer");var _PrimitiveComponent2=require("./PrimitiveComponent");function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var ALL_CHARS="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm.,`~;:'\"!?@#$%^&*()_+={}[]|<>/";var DEFAULTS={fontSize:"16px",fontFamily:"sans-serif",fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",lineHeight:"normal",textAlign:"start",textBaseline:"alphabetic"};function _getTextHeight(font){var fontHolder=document.createElement("span");fontHolder.innerText=ALL_CHARS;fontHolder.style.font=font;var baselineRuler=document.createElement("div");baselineRuler.style.display="inline-block";baselineRuler.style.width="1px";baselineRuler.style.height="0";baselineRuler.style.verticalAlign="baseline";var wrapper=document.createElement("div");wrapper.appendChild(fontHolder);wrapper.appendChild(baselineRuler);wrapper.style.whiteSpace="nowrap";document.body.appendChild(wrapper);var fontRect=fontHolder.getBoundingClientRect();var baselineRect=baselineRuler.getBoundingClientRect();var fontTop=fontRect.top+document.body.scrollTop;var fontBottom=fontTop+fontRect.height;var baseline=baselineRect.top+document.body.scrollTop;document.body.removeChild(wrapper);var ascentFromBaseline=baseline-fontTop;var descentFromBaseline=fontBottom-baseline;return{height:fontRect.height,ascent:ascentFromBaseline,descent:descentFromBaseline}}var Text=function(_PrimitiveComponent){_inherits(Text,_PrimitiveComponent);function Text(options){var _this;_classCallCheck(this,Text);_this=_possibleConstructorReturn(this,_getPrototypeOf(Text).call(this,options));_this.text=options.text;_this.fontSize=options.fontSize||DEFAULTS.fontSize;_this.fontFamily=options.fontFamily||DEFAULTS.fontFamily;_this.fontStyle=options.fontStyle||DEFAULTS.fontStyle;_this.fontVariant=options.fontVariant||DEFAULTS.fontVariant;_this.fontWeight=options.fontWeight||DEFAULTS.fontWeight;_this.lineHeight=options.lineHeight||DEFAULTS.lineHeight;_this.textAlign=options.textAlign||DEFAULTS.textAlign;_this.textBaseline=options.textBaseline||DEFAULTS.textBaseline;_this._textMetricsNeedUpdate=true;return _this}_createClass(Text,[{key:"_updateStyle",value:function _updateStyle(options){Object.assign(this.style,options,{font:"".concat(this.fontStyle," ").concat(this.fontVariant," ").concat(this.fontWeight," ").concat(this.fontSize,"/").concat(this.lineHeight," ").concat(this.fontFamily),textAlign:this.textAlign,textBaseline:this.textBaseline})}},{key:"render",value:function render(){this._textMetricsNeedUpdate=true;this._updateStyle();_Renderer.Renderer.drawText(0,this.textMetrics.ascent,this.text,this._prerenderingContext,this.style)}},{key:"textMetrics",get:function get(){if(this._textMetricsNeedUpdate||this._textMetrics===null){this._updateStyle();this._textMetrics=_Renderer.Renderer.measureText(this.text,this._prerenderingContext,this.style);Object.assign(this._textMetrics,_getTextHeight(this.style.font));this._textMetricsNeedUpdate=false}return this._textMetrics}},{key:"boundingBox",get:function get(){return{top:this.offset.y-this.textMetrics.ascent,left:this.offset.x,bottom:this.offset.y+this.textMetrics.descent,right:this.offset.x+this.textMetrics.width}}}]);return Text}(_PrimitiveComponent2.PrimitiveComponent);exports.Text=Text},{"./PrimitiveComponent":32,"./Renderer":34}],36:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.VectorPath=void 0;var _Renderer=require("./Renderer");var _PrimitiveComponent2=require("./PrimitiveComponent");var _vectorious=require("vectorious");var _Line=require("./Line");function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return _get(target,property,receiver||target)}function set(target,property,value,receiver){if(typeof Reflect!=="undefined"&&Reflect.set){set=Reflect.set}else{set=function set(target,property,value,receiver){var base=_superPropBase(target,property);var desc;if(base){desc=Object.getOwnPropertyDescriptor(base,property);if(desc.set){desc.set.call(receiver,value);return true}else if(!desc.writable){return false}}desc=Object.getOwnPropertyDescriptor(receiver,property);if(desc){if(!desc.writable){return false}desc.value=value;Object.defineProperty(receiver,property,desc)}else{_defineProperty(receiver,property,value)}return true}}return set(target,property,value,receiver)}function _set(target,property,value,receiver,isStrict){var s=set(target,property,value,receiver||target);if(!s&&isStrict){throw new Error("failed to set property")}return value}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var VectorPath=function(_PrimitiveComponent){_inherits(VectorPath,_PrimitiveComponent);function VectorPath(options){var _this;_classCallCheck(this,VectorPath);_this=_possibleConstructorReturn(this,_getPrototypeOf(VectorPath).call(this,options));_this._vertices=[];_this.vertices=options.vertices||[];_this._normalizedBoundingBox=null;return _this}_createClass(VectorPath,[{key:"pointIsInObject",value:function pointIsInObject(x,y){var inside=false;if(_get(_getPrototypeOf(VectorPath.prototype),"pointIsInObject",this).call(this,x,y)){var l=new _Line.Line(new _vectorious.Vector([x,y]),new _vectorious.Vector([1,0]));var compoundScale=this.compoundScale;var offset=this.offset;for(var i=0;i<this._normalizedVertices.length;i++){var j=i+1>=this._normalizedVertices.length?0:i+1;var v=scaleVectorXY(this._normalizedVertices[i],compoundScale.scaleWidth,compoundScale.scaleHeight).add(offset);var w=scaleVectorXY(this._normalizedVertices[j],compoundScale.scaleWidth,compoundScale.scaleHeight).add(offset);var edgeDirection=_vectorious.Vector.subtract(w,v).normalize();var edge=new _Line.Line(v,edgeDirection);var intersection=edge.intersectionWith(l);if(intersection===null){continue}var intersectToTheRight=intersection.x-x>=0;if(!intersectToTheRight){continue}var negativeX=edgeDirection.x<0;var negativeY=edgeDirection.y<0;var leftVertex=negativeX?w:v;var rightVertex=negativeX?v:w;var topVertex=negativeY?w:v;var bottomVertex=negativeY?v:w;var intersectWithinSegment=intersection.x-leftVertex.x>=0&&rightVertex.x-intersection.x>=0&&intersection.y-topVertex.y>=0&&bottomVertex.y-intersection.y>=0;if(intersectWithinSegment){inside=!inside}}}return inside}},{key:"render",value:function render(){var boundingBox=this.boundingBox;var offset=this.offset;var compoundScale=this.compoundScale;var pathToDraw=this._normalizedVertices.map(function(vertex){return scaleVectorXY(vertex,compoundScale.scaleWidth,compoundScale.scaleHeight).subtract(new _vectorious.Vector([boundingBox.left,boundingBox.top])).add(offset)});_Renderer.Renderer.drawPath(pathToDraw,this._prerenderingContext,this.style)}},{key:"boundingBox",get:function get(){this._normalizedBoundingBox={top:0,left:0,right:this._right-this._left,bottom:this._bottom-this._top};return{top:this._normalizedBoundingBox.top*this.compoundScale.scaleHeight+this.offset.y-this.style.lineWidth,left:this._normalizedBoundingBox.left*this.compoundScale.scaleWidth+this.offset.x-this.style.lineWidth,bottom:this._normalizedBoundingBox.bottom*this.compoundScale.scaleHeight+this.offset.y+this.style.lineWidth,right:this._normalizedBoundingBox.right*this.compoundScale.scaleWidth+this.offset.x+this.style.lineWidth}}},{key:"vertices",get:function get(){return this._vertices},set:function set(verts){this._vertices=verts.map(function(v){return new _vectorious.Vector([v.x,v.y])});var yCoordinates=this.vertices.map(function(v){return v.y});var xCoordinates=this.vertices.map(function(v){return v.x});this._left=Math.min.apply(null,xCoordinates);this._top=Math.min.apply(null,yCoordinates);this._right=Math.max.apply(null,xCoordinates);this._bottom=Math.max.apply(null,yCoordinates);_set(_getPrototypeOf(VectorPath.prototype),"d",new _vectorious.Vector([this._left,this._top]),this,true);var normalizationVector=this.d;this._normalizedVertices=this.vertices.map(function(v){return v.subtract(normalizationVector)});this.needsDraw=true;this.needsRender=true}}]);return VectorPath}(_PrimitiveComponent2.PrimitiveComponent);exports.VectorPath=VectorPath;function scaleVectorXY(vector,scaleX,scaleY){return new _vectorious.Vector([vector.x*scaleX,vector.y*scaleY])}},{"./Line":31,"./PrimitiveComponent":32,"./Renderer":34,vectorious:23}]},{},[26])(26)});
