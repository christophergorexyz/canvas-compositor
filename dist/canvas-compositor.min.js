(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.CanvasCompositor=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){},{}],2:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var NDArray_1=require("./NDArray");var Vector_1=require("./Vector");var nblas;try{nblas=require("nblas")}catch(err){}var magicHelper=function(n,x,y){return(x+y*2+1)%n};var Matrix=function(_super){__extends(Matrix,_super);function Matrix(data,options){var _this=this;if(typeof data==="number"&&typeof options==="number"){_this=_super.call(this,new Float32Array(data*options),{shape:[data,options]})||this}else{_this=_super.call(this,data,options)||this}return _this}Matrix.add=function(a,b){return a.copy().add(b)};Matrix.augment=function(a,b){return a.copy().augment(b)};Matrix.binOp=function(a,b,op){return a.copy().binOp(b,op)};Matrix.equals=function(a,b){return a.equals(b)};Matrix.fill=function(r,c,value,type){if(value===void 0){value=0}if(type===void 0){type=Float32Array}if(r<=0||c<=0){throw new Error("invalid size")}var size=r*c;var data=new type(size);return new Matrix(data,{shape:[r,c]}).fill(value)};Matrix.identity=function(size,type){if(type===void 0){type=Float32Array}return Matrix.fill(size,size,function(i){return i%size===Math.floor(i/size)?1:0},type)};Matrix.magic=function(size,type){if(type===void 0){type=Float32Array}if(size<0){throw new Error("invalid size")}var data=new type(size*size);var i;var j;for(i=0;i<size;i+=1){for(j=0;j<size;j+=1){data[(size-i-1)*size+(size-j-1)]=magicHelper(size,size-j-1,i)*size+magicHelper(size,j,i)+1}}return new Matrix(data,{shape:[size,size]})};Matrix.multiply=function(a,b){return a.multiply(b)};Matrix.ones=function(r,c,type){if(type===void 0){type=Float32Array}return Matrix.fill(r,c,1,type)};Matrix.plu=function(matrix){return matrix.copy().plu()};Matrix.product=function(a,b){return a.copy().product(b)};Matrix.random=function(r,c,min,max,type){if(min===void 0){min=0}if(max===void 0){max=1}if(type===void 0){type=Float32Array}return Matrix.fill(r,c,min,type).map(function(value){return value+Math.random()*(max-min)})};Matrix.rank=function(matrix){return matrix.copy().rank()};Matrix.scale=function(a,scalar){return a.copy().scale(scalar)};Matrix.subtract=function(a,b){return a.copy().subtract(b)};Matrix.zeros=function(r,c,type){if(type===void 0){type=Float32Array}return Matrix.fill(r,c,0,type)};Matrix.prototype.augment=function(matrix){var _a=this.shape,r1=_a[0],c1=_a[1];var _b=matrix.shape,r2=_b[0],c2=_b[1];if(r2===0||c2===0){return this}if(r1!==r2){throw new Error("rows do not match")}var d1=this.data;var d2=matrix.data;var length=c1+c2;var data=new this.type(length*r1);var i;var j;for(i=0;i<r1;i+=1){for(j=0;j<c1;j+=1){data[i*length+j]=d1[i*c1+j]}}for(i=0;i<r2;i+=1){for(j=0;j<c2;j+=1){data[i*length+j+c1]=d2[i*c2+j]}}this.shape=[r1,length];this.length=data.length;this.data=data;return this};Matrix.prototype.binOp=function(matrix,op){var _a=this.shape,r1=_a[0],c1=_a[1];var _b=matrix.shape,r2=_b[0],c2=_b[1];if(r1!==r2||c1!==c2){throw new Error("sizes do not match!")}var _c=this,d1=_c.data,length=_c.length;var d2=matrix.data;var i;for(i=0;i<length;i+=1){d1[i]=op(d1[i],d2[i],i)}return this};Matrix.prototype.check=function(i,j){var _a=this.shape,r=_a[0],c=_a[1];if(isNaN(i)||isNaN(j)){throw new Error("one of the indices is not a number")}if(i<0||j<0||i>r-1||j>c-1){throw new Error("index out of bounds")}};Matrix.prototype.determinant=function(){var _a=this.shape,r=_a[0],c=_a[1];if(r!==c){throw new Error("matrix is not square")}var _b=Matrix.plu(this),lu=_b[0],ipiv=_b[1];var product=1;var sign=1;var i;for(i=0;i<r;i+=1){if(i!==ipiv[i]){sign*=-1}}for(i=0;i<r;i+=1){product*=lu.data[i*c+i]}return sign*product};Matrix.prototype.diag=function(){var data=this.data;var _a=this.shape,r=_a[0],c=_a[1];var diag=new this.type(Math.min(r,c));var i;for(i=0;i<r&&i<c;i+=1){diag[i]=data[i*c+i]}return new Vector_1.Vector(diag)};Matrix.prototype.each=function(callback){var c=this.shape[1];var _a=this,data=_a.data,length=_a.length;var i;for(i=0;i<length;i+=1){callback.call(this,data[i],c===0?0:Math.floor(i/c),i%c)}return this};Matrix.prototype.gauss=function(){var _a=this.shape,r=_a[0],c=_a[1];var copy=this.copy();var lead=0;var pivot;var leadValue;var i;var j;var k;for(i=0;i<r;i+=1){if(c<=lead){throw new Error("matrix is singular")}j=i;while(copy.data[j*c+lead]===0){j+=1;if(r===j){j=i;lead+=1;if(c===lead){throw new Error("matrix is singular")}}}copy.swap(i,j);pivot=copy.data[i*c+lead];if(pivot!==0){for(k=0;k<c;k+=1){copy.data[i*c+k]=copy.data[i*c+k]/pivot}}for(j=0;j<r;j+=1){leadValue=copy.data[j*c+lead];if(j!==i){for(k=0;k<c;k+=1){copy.data[j*c+k]=copy.data[j*c+k]-copy.data[i*c+k]*leadValue}}}lead+=1}for(i=0;i<r;i+=1){pivot=0;for(j=0;j<c;j+=1){if(pivot===0){pivot=copy.data[i*c+j]}}if(pivot===0){for(k=0;k<c;k+=1){copy.data[i*c+k]=copy.data[i*c+k]/pivot}}}return copy};Matrix.prototype.get=function(i,j){this.check(i,j);return this.data[i*this.shape[1]+j]};Matrix.prototype.inverse=function(){var _a=this.shape,r=_a[0],c=_a[1];if(r!==c){throw new Error("invalid dimensions")}var identity=Matrix.identity(r);var augmented=Matrix.augment(this,identity);var gauss=augmented.gauss();var left=Matrix.zeros(r,c);var right=Matrix.zeros(r,c);var n=gauss.shape[1];var i;var j;for(i=0;i<r;i+=1){for(j=0;j<n;j+=1){if(j<c){left.set(i,j,gauss.get(i,j))}else{right.set(i,j-r,gauss.get(i,j))}}}if(!left.equals(Matrix.identity(r))){throw new Error("matrix is not invertible")}return right};Matrix.prototype.lu=function(){var _a=this.shape,r=_a[0],c=_a[1];var _b=Matrix.plu(this),plu=_b[0],ipiv=_b[1];var lower=plu.copy();var upper=plu.copy();var i;var j;for(i=0;i<r;i+=1){for(j=i;j<c;j+=1){lower.data[i*c+j]=i===j?1:0}}for(i=0;i<r;i+=1){for(j=0;j<i&&j<c;j+=1){upper.data[i*c+j]=0}}return[lower,upper,ipiv]};Matrix.prototype.lusolve=function(rhs,ipiv){var data=this.data;var _a=rhs.shape,n=_a[0],nrhs=_a[1];var x=rhs.data;var i;var j;var k;for(i=0;i<ipiv.length;i+=1){if(i!==ipiv[i]){rhs.swap(i,ipiv[i])}}for(k=0;k<nrhs;k+=1){for(i=0;i<n;i+=1){for(j=0;j<i;j+=1){x[i*nrhs+k]-=data[i*n+j]*x[j*nrhs+k]}}for(i=n-1;i>=0;i-=1){for(j=i+1;j<n;j+=1){x[i*nrhs+k]-=data[i*n+j]*x[j*nrhs+k]}x[i*nrhs+k]/=data[i*n+i]}}return rhs};Matrix.prototype.map=function(callback){var c=this.shape[1];var length=this.length;var mapped=this.copy();var data=mapped.data;var i;for(i=0;i<length;i+=1){data[i]=callback.call(mapped,data[i],c===0?0:Math.floor(i/c),i%c,data)}return mapped};Matrix.prototype.multiply=function(matrix){var _a=this.shape,r1=_a[0],c1=_a[1];var _b=matrix.shape,r2=_b[0],c2=_b[1];if(c1!==r2){throw new Error("sizes do not match")}var d1=this.data;var d2=matrix.data;var data=new this.type(r1*c2);try{nblas.gemm(d1,d2,data,r1,c2,c1)}catch(err){var i=void 0;var j=void 0;var k=void 0;var sum=void 0;for(i=0;i<r1;i+=1){for(j=0;j<c2;j+=1){sum=0;for(k=0;k<c1;k+=1){sum+=d1[i*c1+k]*d2[j+k*c2]}data[i*c2+j]=sum}}}return new Matrix(data,{shape:[r1,c2]})};Object.defineProperty(Matrix.prototype,"T",{get:function(){return this.transpose()},enumerable:true,configurable:true});Matrix.prototype.plu=function(){var data=this.data;var n=this.shape[0];var ipiv=new Int32Array(n);var max;var abs;var diag;var p;var i;var j;var k;for(k=0;k<n;k+=1){p=k;max=Math.abs(data[k*n+k]);for(j=k+1;j<n;j+=1){abs=Math.abs(data[j*n+k]);if(max<abs){max=abs;p=j}}ipiv[k]=p;if(p!==k){this.swap(k,p)}diag=data[k*n+k];for(i=k+1;i<n;i+=1){data[i*n+k]/=diag}for(i=k+1;i<n;i+=1){for(j=k+1;j<n-1;j+=1){data[i*n+j]-=data[i*n+k]*data[k*n+j];j+=1;data[i*n+j]-=data[i*n+k]*data[k*n+j]}if(j===n-1){data[i*n+j]-=data[i*n+k]*data[k*n+j]}}}return[this,ipiv]};Matrix.prototype.rank=function(){var vectors=this.toArray().map(function(row){return new Vector_1.Vector(row)});var _a=this.shape,r=_a[0],c=_a[1];var counter=0;var tmp;var pivot;var target;var scalar;var i;var j;for(i=0;i<r-1;i+=1){pivot=undefined;for(j=i;j<r;j+=1){if(vectors[i].get(i)!==0){if(i!==j){tmp=vectors[i];vectors[i]=vectors[j];vectors[j]=tmp}pivot=vectors[i];break}}if(pivot===undefined){continue}for(j=i+1;j<r;j+=1){target=vectors[j];scalar=target.get(i)/pivot.get(i);vectors[j]=target.subtract(pivot.scale(scalar))}}for(i=0;i<r;i+=1){for(j=0;j<c;j+=1){if(vectors[i].get(j)!==0){counter+=1;break}}}return counter};Matrix.prototype.reduce=function(callback,initialValue){var c=this.shape[1];var length=this.length;if(length===0&&initialValue===undefined){throw new Error("reduce of empty matrix with no initial value.")}var data=this.data;var i;var value;if(initialValue===undefined){value=data[0];i=1}else{value=initialValue;i=0}for(;i<length;i+=1){value=callback.call(this,value,data[i],c===0?0:Math.floor(i/c),i%c)}return value};Matrix.prototype.rowAdd=function(dest,source,scalar){if(scalar===void 0){scalar=1}this.check(dest,0);this.check(source,0);var c=this.shape[1];var i;for(i=0;i<c;i+=1){this.set(dest,i,this.get(dest,i)+this.get(source,i)*scalar)}return this};Matrix.prototype.set=function(i,j,value){this.check(i,j);this.data[i*this.shape[1]+j]=value;return this};Matrix.prototype.solve=function(rhs){var _a=Matrix.plu(this),lu=_a[0],ipiv=_a[1];return lu.lusolve(rhs.copy(),ipiv)};Matrix.prototype.swap=function(i,j){var _a=this.shape,r=_a[0],c=_a[1];if(i<0||j<0||i>r-1||j>r-1){throw new Error("index out of bounds")}var copy=this.data.slice(i*c,(i+1)*c);this.data.copyWithin(i*c,j*c,(j+1)*c);this.data.set(copy,j*c);return this};Matrix.prototype.toArray=function(){var _a=this.shape,r=_a[0],c=_a[1];var result=[];var i;for(i=0;i<r;i+=1){result.push(Array.prototype.slice.call(this.data.subarray(i*c,(i+1)*c)))}return result};Matrix.prototype.toString=function(){var _a=this.shape,r=_a[0],c=_a[1];var result=[];var i;for(i=0;i<r;i+=1){result.push("["+this.data.subarray(i*c,(i+1)*c)+"]")}return"["+result.join(", \n")+"]"};Matrix.prototype.trace=function(){var diag=this.diag();var length=diag.length;var result=0;var i;for(i=0;i<length;i+=1){result+=diag.get(i)}return result};Matrix.prototype.transpose=function(){var _a=this.shape,r=_a[0],c=_a[1];var data=new this.type(c*r);var i;var j;for(i=0;i<r;i+=1){for(j=0;j<c;j+=1){data[j*r+i]=this.data[i*c+j]}}return new Matrix(data,{shape:[c,r]})};return Matrix}(NDArray_1.NDArray);exports.Matrix=Matrix;try{window.Matrix=Matrix}catch(err){}},{"./NDArray":3,"./Vector":4,nblas:1}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("./util");var nblas;try{nblas=require("nblas")}catch(err){}var abs=Math.abs,acos=Math.acos,acosh=Math.acosh,asin=Math.asin,asinh=Math.asinh,atan=Math.atan,atanh=Math.atanh,cbrt=Math.cbrt,ceil=Math.ceil,cos=Math.cos,cosh=Math.cosh,exp=Math.exp,expm1=Math.expm1,floor=Math.floor,fround=Math.fround,log=Math.log,log1p=Math.log1p,log10=Math.log10,log2=Math.log2,pow=Math.pow,round=Math.round,sign=Math.sign,sin=Math.sin,sinh=Math.sinh,sqrt=Math.sqrt,tan=Math.tan,tanh=Math.tanh,trunc=Math.trunc;var NDArray=function(){function NDArray(data,options){this.data=new Float32Array(0);this.length=0;this.shape=[0];this.type=Float32Array;if(util_1.isTypedArray(data)){this.data=data;this.shape=typeof options==="object"?options.shape:[this.data.length];this.length=this.data.length;this.type=util_1.type(data)}else if(data instanceof Array){this.data=new Float32Array(util_1.flatten(data));this.shape=util_1.shape(data);this.length=this.data.length}else if(data instanceof NDArray){return data.copy()}}NDArray.prototype.abs=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=abs(this.data[i])}return this};NDArray.prototype.acos=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=acos(this.data[i])}return this};NDArray.prototype.acosh=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=acosh(this.data[i])}return this};NDArray.prototype.add=function(x,alpha){if(alpha===void 0){alpha=1}this.equilateral(x);this.equidimensional(x);try{nblas.axpy(x.data,this.data,alpha)}catch(err){var _a=this,d1=_a.data,l1=_a.length;var d2=x.data;var i=void 0;for(i=0;i<l1;i+=1){d1[i]+=alpha*d2[i]}}return this};NDArray.prototype.asin=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=asin(this.data[i])}return this};NDArray.prototype.asinh=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=asinh(this.data[i])}return this};NDArray.prototype.atan=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=atan(this.data[i])}return this};NDArray.prototype.atanh=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=atanh(this.data[i])}return this};NDArray.prototype.cbrt=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=cbrt(this.data[i])}return this};NDArray.prototype.ceil=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=ceil(this.data[i])}return this};NDArray.prototype.copy=function(){var copy=Object.assign(Object.create(Object.getPrototypeOf(this)),this);copy.data=new this.type(this.data);copy.shape=this.shape;copy.length=this.length;copy.type=this.type;return copy};NDArray.prototype.cos=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=cos(this.data[i])}return this};NDArray.prototype.cosh=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=cosh(this.data[i])}return this};NDArray.prototype.dot=function(x){this.equilateral(x);this.equidimensional(x);var _a=this,d1=_a.data,l1=_a.length;var d2=x.data;try{return nblas.dot(d1,d2)}catch(err){var result=0;var i=void 0;for(i=0;i<l1;i+=1){result+=d1[i]*d2[i]}return result}};NDArray.prototype.equals=function(x){this.equilateral(x);this.equidimensional(x);var _a=this,d1=_a.data,l1=_a.length;var d2=x.data;var i;for(i=0;i<l1;i+=1){if(d1[i]!==d2[i]){return false}}return true};NDArray.prototype.equidimensional=function(x){var s1=this.shape;var s2=x.shape;if(!s1.every(function(dim,i){return dim===s2[i]})){throw new Error("shapes "+s1+" and "+s2+" do not match")}};NDArray.prototype.equilateral=function(x){var l1=this.length;var l2=x.length;if(l1!==l2){throw new Error("lengths "+l1+" and "+l2+" do not match")}};NDArray.prototype.exp=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=exp(this.data[i])}return this};NDArray.prototype.expm1=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=expm1(this.data[i])}return this};NDArray.prototype.fill=function(value){if(value===void 0){value=0}var _a=this,data=_a.data,length=_a.length;var i;for(i=0;i<length;i+=1){data[i]=value instanceof Function?value(i):value}return this};NDArray.prototype.floor=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=floor(this.data[i])}return this};NDArray.prototype.fround=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=fround(this.data[i])}return this};NDArray.prototype.log=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=log(this.data[i])}return this};NDArray.prototype.log10=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=log10(this.data[i])}return this};NDArray.prototype.log1p=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=log1p(this.data[i])}return this};NDArray.prototype.log2=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=log2(this.data[i])}return this};NDArray.prototype.magnitude=function(){var length=this.length;if(length===0){return 0}var data=this.data;try{return nblas.nrm2(data)}catch(err){var result=0;var i=void 0;for(i=0;i<length;i+=1){result+=data[i]*data[i]}return Math.sqrt(result)}};NDArray.prototype.max=function(){var data=this.data;try{return data[nblas.iamax(data)]}catch(err){var length_1=this.length;var result=Number.NEGATIVE_INFINITY;var i=void 0;for(i=0;i<length_1;i+=1){result=result<data[i]?data[i]:result}return result}};NDArray.prototype.min=function(){var _a=this,data=_a.data,length=_a.length;var result=Number.POSITIVE_INFINITY;var i;for(i=0;i<length;i+=1){result=result<data[i]?result:data[i]}return result};NDArray.prototype.pow=function(exponent){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=pow(this.data[i],exponent)}return this};NDArray.prototype.product=function(x){this.equilateral(x);this.equidimensional(x);var _a=this,d1=_a.data,l1=_a.length;var d2=x.data;var i;for(i=0;i<l1;i+=1){d1[i]*=d2[i]}return this};NDArray.prototype.reshape=function(s){var length=this.length;if(s.reduce(function(sum,dim){return sum*dim},1)!==length){throw new Error("shape "+util_1.shape+" does not match length "+length)}this.shape=s;return this};NDArray.prototype.round=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=round(this.data[i])}return this};NDArray.prototype.scale=function(scalar){var data=this.data;try{nblas.scal(data,scalar)}catch(err){var length_2=this.length;var i=void 0;for(i=0;i<length_2;i+=1){data[i]*=scalar}}return this};NDArray.prototype.sign=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=sign(this.data[i])}return this};NDArray.prototype.sin=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=sin(this.data[i])}return this};NDArray.prototype.sinh=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=sinh(this.data[i])}return this};NDArray.prototype.sqrt=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=sqrt(this.data[i])}return this};NDArray.prototype.subtract=function(x){return this.add(x,-1)};NDArray.prototype.tan=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=tan(this.data[i])}return this};NDArray.prototype.tanh=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=tanh(this.data[i])}return this};NDArray.prototype.trunc=function(){var l1=this.length;var i;for(i=0;i<l1;i+=1){this.data[i]=trunc(this.data[i])}return this};return NDArray}();exports.NDArray=NDArray;try{window.NDArray=NDArray}catch(error){}},{"./util":6,nblas:1}],4:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var NDArray_1=require("./NDArray");var Vector=function(_super){__extends(Vector,_super);function Vector(data){return _super.call(this,typeof data==="number"?new Float32Array(data):data)||this}Vector.add=function(a,b){return a.copy().add(b)};Vector.angle=function(a,b){return a.angle(b)};Vector.binOp=function(a,b,op){return a.copy().binOp(b,op)};Vector.combine=function(a,b){return a.copy().combine(b)};Vector.dot=function(a,b){return a.dot(b)};Vector.equals=function(a,b){return a.equals(b)};Vector.fill=function(count,value,type){if(value===void 0){value=0}if(type===void 0){type=Float32Array}if(count<0){throw new Error("invalid size")}var data=new type(count);return new Vector(data).fill(value)};Vector.normalize=function(vector){return vector.copy().normalize()};Vector.ones=function(count,type){if(type===void 0){type=Float32Array}return Vector.fill(count,1,type)};Vector.project=function(a,b){return a.project(b.copy())};Vector.random=function(count,min,max,type){if(min===void 0){min=0}if(max===void 0){max=1}if(type===void 0){type=Float32Array}return Vector.fill(count,min,type).map(function(value){return value+Math.random()*(max-min)})};Vector.range=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var type=Float32Array;var backwards=false;var start;var step;var end;if(typeof args[args.length-1]==="function"){type=args.pop()}switch(args.length){case 2:end=args.pop();step=1;start=args.pop();break;case 3:end=args.pop();step=args.pop();start=args.pop();break;default:throw new Error("invalid range")}if(end-start<0){var copy=end;end=start;start=copy;backwards=true}if(step>end-start){throw new Error("invalid range")}var data=new type(Math.ceil((end-start)/step));var i=start;var j=0;if(backwards){for(;i<end;i+=step,j+=1){data[j]=end-i+start}}else{for(;i<end;i+=step,j+=1){data[j]=i}}return new Vector(data)};Vector.scale=function(vector,scalar){return vector.copy().scale(scalar)};Vector.subtract=function(a,b){return a.copy().subtract(b)};Vector.zeros=function(count,type){if(type===void 0){type=Float32Array}return Vector.fill(count,0,type)};Vector.prototype.angle=function(vector){return Math.acos(this.dot(vector)/this.magnitude()/vector.magnitude())};Vector.prototype.binOp=function(vector,op){var l1=this.length;var l2=vector.length;if(l1!==l2){throw new Error("sizes do not match!")}var i;for(i=0;i<l1;i+=1){this.data[i]=op(this.data[i],vector.data[i],i)}return this};Vector.prototype.check=function(index){if(!isFinite(index)||index<0||index>this.length-1){throw new Error("index out of bounds")}};Vector.prototype.combine=function(vector){var l1=this.length;var l2=vector.length;if(l2===0){return this}if(l1===0){this.data=new vector.type(vector.data);this.length=l2;this.type=vector.type;return this}var d1=this.data;var d2=vector.data;var data=new this.type(l1+l2);data.set(d1);data.set(d2,l1);this.data=data;this.length=l1+l2;this.shape=[l1+l2];return this};Vector.prototype.cross=function(vector){if(this.length!==3||vector.length!==3){throw new Error("cross(...) : vectors must have three components.")}var c1=this.y*vector.z-this.z*vector.y;var c2=this.z*vector.x-this.x*vector.z;var c3=this.x*vector.y-this.y*vector.x;return new Vector([c1,c2,c3])};Vector.prototype.each=function(callback){var i;for(i=0;i<this.length;i+=1){callback.call(this,this.data[i],i,this.data)}return this};Vector.prototype.get=function(index){this.check(index);return this.data[index]};Vector.prototype.map=function(callback){var l=this.length;var mapped=this.copy();var data=mapped.data;var i;for(i=0;i<l;i+=1){data[i]=callback.call(mapped,data[i],i,data)}return mapped};Vector.prototype.normalize=function(){return this.scale(1/this.magnitude())};Vector.prototype.project=function(vector){return vector.scale(this.dot(vector)/vector.dot(vector))};Vector.prototype.push=function(value){return this.combine(new Vector([value]))};Vector.prototype.reduce=function(callback,initialValue){var l=this.length;if(l===0&&initialValue===undefined){throw new Error("Reduce of empty matrix with no initial value.")}var i;var value;if(initialValue===undefined){value=this.data[0];i=1}else{value=initialValue;i=0}for(;i<l;i+=1){value=callback.call(this,value,this.data[i],i,this.data)}return value};Vector.prototype.set=function(index,value){this.check(index);this.data[index]=value;return this};Object.defineProperty(Vector.prototype,"x",{get:function(){return this.get(0)},set:function(value){this.set(0,value)},enumerable:true,configurable:true});Object.defineProperty(Vector.prototype,"y",{get:function(){return this.get(1)},set:function(value){this.set(1,value)},enumerable:true,configurable:true});Object.defineProperty(Vector.prototype,"z",{get:function(){return this.get(2)},set:function(value){this.set(2,value)},enumerable:true,configurable:true});Object.defineProperty(Vector.prototype,"w",{get:function(){return this.get(3)},set:function(value){this.set(3,value)},enumerable:true,configurable:true});Vector.prototype.toArray=function(){return[].slice.call(this.data)};Vector.prototype.toString=function(){var l=this.length;var result=["["];var i=0;if(i<l){result.push(String(this.data[i]));i+=1}while(i<l){result.push(", "+this.data[i]);i+=1}result.push("]");return result.join("")};return Vector}(NDArray_1.NDArray);exports.Vector=Vector;try{window.Vector=Vector}catch(error){}},{"./NDArray":3}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Vector_1=require("./Vector");exports.Vector=Vector_1.Vector;var Matrix_1=require("./Matrix");exports.Matrix=Matrix_1.Matrix;var NDArray_1=require("./NDArray");exports.NDArray=NDArray_1.NDArray},{"./Matrix":2,"./NDArray":3,"./Vector":4}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.flatten=function(input){return input.reduce(function(acc,next){return acc.concat(Array.isArray(next)?exports.flatten(next):next)},[])};exports.shape=function(input){return Array.isArray(input)?[input.length].concat(exports.shape(input[0])):[]};exports.type=function(input){switch(input.constructor.name){case"Int8Array":return Int8Array;case"Uint8Array":return Uint8Array;case"Int16Array":return Int16Array;case"Uint16Array":return Uint16Array;case"Int32Array":return Int32Array;case"Uint32Array":return Uint32Array;case"Uint8ClampedArray":return Uint8ClampedArray;case"Float64Array":return Float64Array;default:return Float32Array}};exports.isTypedArray=function(input){return!!(input&&input.buffer instanceof ArrayBuffer&&input.BYTES_PER_ELEMENT)}},{}],7:[function(require,module,exports){"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _vectorious=require("vectorious");var _PrimitiveComponent2=_interopRequireDefault(require("./PrimitiveComponent"));var _Renderer=require("./Renderer");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function set(target,property,value,receiver){if(typeof Reflect!=="undefined"&&Reflect.set){set=Reflect.set}else{set=function set(target,property,value,receiver){var base=_superPropBase(target,property);var desc;if(base){desc=Object.getOwnPropertyDescriptor(base,property);if(desc.set){desc.set.call(receiver,value);return true}else if(!desc.writable){return false}}desc=Object.getOwnPropertyDescriptor(receiver,property);if(desc){if(!desc.writable){return false}desc.value=value;Object.defineProperty(receiver,property,desc)}else{_defineProperty(receiver,property,value)}return true}}return set(target,property,value,receiver)}function _set(target,property,value,receiver,isStrict){var s=set(target,property,value,receiver||target);if(!s&&isStrict){throw new Error("failed to set property")}return value}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _cubicBezier(start,c1,c2,end,t){return start*(1-t)*(1-t)*(1-t)+3*c1*t*(1-t)*(1-t)+3*c2*t*t*(1-t)+end*t*t*t}function _getExtremes(start,c1,c2,end){var a=3*end-9*c2+9*c1-3*start;var b=6*c2-12*c1+6*start;var c=3*c1-3*start;var solutions=[];var localExtrema=[];var disc=b*b-4*a*c;if(disc>=0){if(!Math.abs(a)>0&&Math.abs(b)>0){solutions.push(-c/b)}else if(Math.abs(a)>0){solutions.push((-b+Math.sqrt(disc))/(2*a));solutions.push((-b-Math.sqrt(disc))/(2*a))}else{throw new Error("no solutions!?!?!")}var _iterator=_createForOfIteratorHelper(solutions),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var t=_step.value;if(0<=t&&t<=1){localExtrema.push(_cubicBezier(start,c1,c2,end,t))}}}catch(err){_iterator.e(err)}finally{_iterator.f()}}localExtrema.push(start,end);return localExtrema}var Bezier=function(_PrimitiveComponent){_inherits(Bezier,_PrimitiveComponent);var _super=_createSuper(Bezier);function Bezier(options){var _thisSuper,_this;_classCallCheck(this,Bezier);_this=_super.call(this,options);var start=new _vectorious.Vector([options.start.x,options.start.y]);var end=new _vectorious.Vector([options.end.x,options.end.y]);var control1=new _vectorious.Vector([options.control1.x,options.control1.y]);var control2=new _vectorious.Vector([options.control2.x,options.control2.y]);_this._boundingBox=null;_this._boundingBoxNeedsUpdate=true;var xExtrema=_getExtremes(start.x,control1.x,control2,end.x);var yExtrema=_getExtremes(start.y,control1.y,control2.y,end.y);_set((_thisSuper=_assertThisInitialized(_this),_getPrototypeOf(Bezier.prototype)),"d",new _vectorious.Vector([Math.min.apply(null,xExtrema),Math.min.apply(null,yExtrema)]),_thisSuper,true);_this._start=_vectorious.Vector.subtract(start,_this.d);_this._end=_vectorious.Vector.subtract(end,_this.d);_this._control1=_vectorious.Vector.subtract(control1,_this.d);_this._control2=_vectorious.Vector.subtract(control2,_this.d);return _this}_createClass(Bezier,[{key:"boundingBox",get:function get(){var lineWidth=this.style.lineWidth;var offset=this.offset;var start=_vectorious.Vector.add(this._start,this.offset);var control1=_vectorious.Vector.add(this._control1,this.offset);var control2=_vectorious.Vector.add(this._control2,this.offset);var end=_vectorious.Vector.add(this._end,this.offset);var xExtrema=_getExtremes(start.x,control1.x,control2,end.x);var yExtrema=_getExtremes(start.y,control1.y,control2.y,end.y);this._boundingBox={top:Math.min.apply(null,yExtrema)-lineWidth,right:Math.max.apply(null,xExtrema)+lineWidth,bottom:Math.max.apply(null,yExtrema)+lineWidth,left:Math.min.apply(null,xExtrema)-lineWidth};this._boundingBoxNeedsUpdate=false;return this._boundingBox}},{key:"render",value:function render(){(0,_Renderer.drawBezier)(this._start,this._end,this._control1,this._control2,this._prerenderingContext,this.style)}}]);return Bezier}(_PrimitiveComponent2["default"]);exports["default"]=Bezier},{"./PrimitiveComponent":17,"./Renderer":19,vectorious:5}],8:[function(require,module,exports){"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _PrimitiveComponent2=_interopRequireDefault(require("./PrimitiveComponent"));var _Renderer=require("./Renderer");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var Circle=function(_PrimitiveComponent){_inherits(Circle,_PrimitiveComponent);var _super=_createSuper(Circle);function Circle(options){var _this;_classCallCheck(this,Circle);_this=_super.call(this,options);_this.radius=options.radius||0;return _this}_createClass(Circle,[{key:"boundingBox",get:function get(){var offset=this.offset;var scale=this.compoundScale;return{top:offset.y-(this.radius*scale.scaleHeight+this.style.lineWidth),left:offset.x-(this.radius*scale.scaleWidth+this.style.lineWidth),bottom:offset.y+this.radius*scale.scaleHeight+this.style.lineWidth,right:offset.x+this.radius*scale.scaleWidth+this.style.lineWidth}}},{key:"render",value:function render(){var scale=this.compoundScale;var lineWidth=this.style.lineWidth;(0,_Renderer.drawCircle)(this.radius*scale.scaleWidth+lineWidth,this.radius*scale.scaleHeight+lineWidth,this.radius*scale.scaleWidth,this._prerenderingContext,this.style)}},{key:"pointIsInObject",value:function pointIsInObject(x,y){var offset=this.offset;var a=x-offset.x;var b=y-offset.y;var c=this.radius;return a*a+b*b<=c*c}}]);return Circle}(_PrimitiveComponent2["default"]);exports["default"]=Circle},{"./PrimitiveComponent":17,"./Renderer":19}],9:[function(require,module,exports){"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _PrimitiveComponent2=_interopRequireDefault(require("./PrimitiveComponent"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function set(target,property,value,receiver){if(typeof Reflect!=="undefined"&&Reflect.set){set=Reflect.set}else{set=function set(target,property,value,receiver){var base=_superPropBase(target,property);var desc;if(base){desc=Object.getOwnPropertyDescriptor(base,property);if(desc.set){desc.set.call(receiver,value);return true}else if(!desc.writable){return false}}desc=Object.getOwnPropertyDescriptor(receiver,property);if(desc){if(!desc.writable){return false}desc.value=value;Object.defineProperty(receiver,property,desc)}else{_defineProperty(receiver,property,value)}return true}}return set(target,property,value,receiver)}function _set(target,property,value,receiver,isStrict){var s=set(target,property,value,receiver||target);if(!s&&isStrict){throw new Error("failed to set property")}return value}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var Composition=function(_PrimitiveComponent){_inherits(Composition,_PrimitiveComponent);var _super=_createSuper(Composition);function Composition(options){var _this;_classCallCheck(this,Composition);_this=_super.call(this,options);options=options||{};_this._children=options.children||[];return _this}_createClass(Composition,[{key:"children",get:function get(){return this._children}},{key:"boundingBox",get:function get(){var top=Infinity,left=Infinity,bottom=-Infinity,right=-Infinity;var _iterator=_createForOfIteratorHelper(this.children),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var c=_step.value;var boundingBox=c.boundingBox;top=Math.min(boundingBox.top,top);left=Math.min(boundingBox.left,left);bottom=Math.max(boundingBox.bottom,bottom);right=Math.max(boundingBox.right,right)}}catch(err){_iterator.e(err)}finally{_iterator.f()}return{top:top,left:left,bottom:bottom,right:right}}},{key:"childrenAt",value:function childrenAt(x,y){return this.children.filter(function(c){return c.PointIsInObject(x,y)})}},{key:"childAt",value:function childAt(x,y){for(var c=this.children.length-1;c>=0;c--){if(this.children[c].pointIsInObject(x,y)){return this.children[c]}}}},{key:"addChild",value:function addChild(child){child.parent=this;this.children.push(child);_set(_getPrototypeOf(Composition.prototype),"needsRender",true,this,true);_set(_getPrototypeOf(Composition.prototype),"needsDraw",true,this,true)}},{key:"addChildren",value:function addChildren(children){var _iterator2=_createForOfIteratorHelper(children),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var c=_step2.value;this.addChild(c)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}},{key:"removeChild",value:function removeChild(child){if(child){var index=this.children.indexOf(child);if(index>=0){_set(_getPrototypeOf(Composition.prototype),"needsRender",true,this,true);_set(_getPrototypeOf(Composition.prototype),"needsDraw",true,this,true);return this.children.splice(index,1)}}}},{key:"render",value:function render(){var boundingBox=this.boundingBox;var offset={top:-boundingBox.top,left:-boundingBox.left,bottom:-boundingBox.bottom,right:-boundingBox.right};var _iterator3=_createForOfIteratorHelper(this.children),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var c=_step3.value;c.draw(this._prerenderingContext,offset)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}}]);return Composition}(_PrimitiveComponent2["default"]);exports["default"]=Composition},{"./PrimitiveComponent":17}],10:[function(require,module,exports){"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _EventEmitter2=_interopRequireDefault(require("./EventEmitter"));var Events=_interopRequireWildcard(require("./Events"));var _Composition=_interopRequireDefault(require("./Composition"));var _Renderer=require("./Renderer");function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap;var cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj)}return newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var Compositor=function(_EventEmitter){_inherits(Compositor,_EventEmitter);var _super=_createSuper(Compositor);function Compositor(canvas){var _this;_classCallCheck(this,Compositor);_this=_super.call(this);_this._canvas=canvas;_this._context=_this._canvas.getContext("2d");var style=window.getComputedStyle(_this._canvas);_this._mouseX=null;_this._mouseY=null;var borderLeft=style.getPropertyValue("border-left")?parseFloat(style.getPropertyValue("border-left")):0;var paddingLeft=style.getPropertyValue("padding-left")?parseFloat(style.getPropertyValue("padding-left")):0;_this._leftPadding=borderLeft+paddingLeft;var borderTop=style.getPropertyValue("border-top")?parseFloat(style.getPropertyValue("border-top")):0;var paddingTop=style.getPropertyValue("padding-top")?parseFloat(style.getPropertyValue("padding-top")):0;_this._topPadding=borderTop+paddingTop;_this._currentTime=0;_this._lastFrameTimestamp=0;_this._targetObject=null;_this._scene=new _Composition["default"](_this.canvas);_this._bindEvents();_this._animationLoop();_this._framerate=0;return _this}_createClass(Compositor,[{key:"framerate",get:function get(){return this._framerate}},{key:"targetObject",get:function get(){return this._targetObject},set:function set(val){this._targetObject=val}},{key:"scene",get:function get(){return this._scene}},{key:"mouseX",get:function get(){return this._mouseX}},{key:"mouseY",get:function get(){return this._mouseY}},{key:"_animationLoop",value:function _animationLoop(){window.requestAnimationFrame(this._animationLoop.bind(this));this._currentTime=+new Date;if(this.scene.needsDraw){(0,_Renderer.clearRect)(0,0,this._canvas.width,this._canvas.height,this._context);this.scene.draw(this._context)}this._framerate=parseInt(1e3/(this._currentTime-this._lastFrameTimestamp));this._lastFrameTimestamp=+new Date}},{key:"_bindEvents",value:function _bindEvents(){var _cc=this;this._canvas.addEventListener(Events.MOUSEDOWN,function(e){_cc.dispatchEvent(e)});this._canvas.addEventListener(Events.MOUSEMOVE,function(e){_cc.dispatchEvent(e)});this._canvas.addEventListener(Events.MOUSEUP,function(e){_cc.dispatchEvent(e)});this._canvas.addEventListener(Events.MOUSEOUT,function(e){_cc.dispatchEvent(e)});this._canvas.addEventListener(Events.CLICK,function(e){_cc.dispatchEvent(e)});this.addEventListener(Events.MOUSEDOWN,this._handleMouseDown);this.addEventListener(Events.MOUSEMOVE,this._handleMouseMove);this.addEventListener(Events.MOUSEUP,this._handleMouseUp);this.addEventListener(Events.MOUSEOUT,this._handleMouseOut);this.addEventListener(Events.CLICK,this._handleClick)}},{key:"_handleMouseDown",value:function _handleMouseDown(e){e.preventDefault();var x=e.offsetX-this._leftPadding;var y=e.offsetY-this._topPadding;e.canvasX=x;e.canvasY=y;var clickedObject=this.scene.childAt(x,y);if(clickedObject){clickedObject.dispatchEvent(e)}}},{key:"_handleMouseUp",value:function _handleMouseUp(e){e.preventDefault();var x=e.offsetX-this._leftPadding;var y=e.offsetY-this._topPadding;e.canvasX=x;e.canvasY=y;var _iterator=_createForOfIteratorHelper(this.scene.children),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var c=_step.value;c.dispatchEvent(e)}}catch(err){_iterator.e(err)}finally{_iterator.f()}var clickedObject=this.scene.childAt(x,y);if(clickedObject){clickedObject.dispatchEvent(e)}}},{key:"_handleMouseMove",value:function _handleMouseMove(e){e.preventDefault();this._mouseX=e.offsetX-this._leftPadding;this._mouseY=e.offsetY-this._topPadding;var _iterator2=_createForOfIteratorHelper(this.scene.children),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var c=_step2.value;c.dispatchEvent(e)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}},{key:"_handleClick",value:function _handleClick(e){e.preventDefault();var x=e.offsetX-this._leftPadding;var y=e.offsetY-this._topPadding;e.canvasX=x;e.canvasY=y;var clickedObject=this.scene.childAt(x,y);if(clickedObject){clickedObject.dispatchEvent(e)}}},{key:"_handleMouseOut",value:function _handleMouseOut(e){e.preventDefault();var _iterator3=_createForOfIteratorHelper(this.scene.children),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var c=_step3.value;c.dispatchEvent(e)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}}]);return Compositor}(_EventEmitter2["default"]);exports["default"]=Compositor},{"./Composition":9,"./EventEmitter":13,"./Events":14,"./Renderer":19}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TEXT_BASELINE=exports.TEXT_ALIGN=exports.FONT=exports.MITER_LIMIT=exports.LINE_JOIN=exports.LINE_WIDTH=exports.LINE_CAP=exports.STROKE_STYLE=exports.FILL_STYLE=void 0;var FILL_STYLE="black";exports.FILL_STYLE=FILL_STYLE;var STROKE_STYLE="black";exports.STROKE_STYLE=STROKE_STYLE;var LINE_CAP="round";exports.LINE_CAP=LINE_CAP;var LINE_WIDTH=1;exports.LINE_WIDTH=LINE_WIDTH;var LINE_JOIN="round";exports.LINE_JOIN=LINE_JOIN;var MITER_LIMIT=10;exports.MITER_LIMIT=MITER_LIMIT;var FONT="10px sans-serif";exports.FONT=FONT;var TEXT_ALIGN="start";exports.TEXT_ALIGN=TEXT_ALIGN;var TEXT_BASELINE="alphabetic";exports.TEXT_BASELINE=TEXT_BASELINE},{}],12:[function(require,module,exports){"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _PrimitiveComponent2=_interopRequireDefault(require("./PrimitiveComponent"));var _Renderer=require("./Renderer");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var Ellipse=function(_PrimitiveComponent){_inherits(Ellipse,_PrimitiveComponent);var _super=_createSuper(Ellipse);function Ellipse(options){var _this;_classCallCheck(this,Ellipse);_this=_super.call(this,options);_this.radius=options.radius||0;_this.minorRadius=options.minorRadius||_this.radius||0;return _this}_createClass(Ellipse,[{key:"boundingBox",get:function get(){var offset=this.offset;var scale=this.compoundScale;var lineWidth=this.style.lineWidth;return{top:offset.y-(this.minorRadius*scale.scaleHeight+lineWidth),left:offset.x-(this.radius*scale.scaleWidth+lineWidth),bottom:offset.y+this.minorRadius*scale.scaleHeight+lineWidth,right:offset.x+this.radius*scale.scaleWidth+lineWidth}}},{key:"render",value:function render(){var scale=this.compoundScale;var lineWidth=this.style.lineWidth;(0,_Renderer.drawEllipse)(this.radius*scale.scaleWidth+lineWidth,this.minorRadius*scale.scaleHeight+lineWidth,this.radius*scale.scaleWidth,this.minorRadius*scale.scaleHeight,this._prerenderingContext,this.style)}},{key:"pointIsInObject",value:function pointIsInObject(x,y){var scale=this.compoundScale;var offset=this.offset;var a=x-offset.x;var b=y-offset.y;var c1=this.radius*scale.scaleWidth;var c2=this.minorRadius*scale.scaleHeight;return a*a/(c1*c1)+b*b/(c2*c2)<=1}}]);return Ellipse}(_PrimitiveComponent2["default"]);exports["default"]=Ellipse},{"./PrimitiveComponent":17,"./Renderer":19}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var EventEmitter=function(){function EventEmitter(){_classCallCheck(this,EventEmitter);this._listeners={}}_createClass(EventEmitter,[{key:"addEventListener",value:function addEventListener(type,callback){if(!(type in this._listeners)){this._listeners[type]=[]}this._listeners[type].push(callback)}},{key:"removeEventListener",value:function removeEventListener(type,callback){if(!(type in this._listeners)){return}var stack=this._listeners[type];for(var i=0,l=stack.length;i<l;i++){if(stack[i]===callback){stack.splice(i,1);return}}}},{key:"dispatchEvent",value:function dispatchEvent(event){if(!(event.type in this._listeners)){return true}var stack=this._listeners[event.type].slice();for(var i=0,l=stack.length;i<l;i++){stack[i].call(this,event)}return!event.defaultPrevented}},{key:"listensFor",value:function listensFor(type){return!!this._listeners[type]}},{key:"hasListener",value:function hasListener(type,callback){return!!this._listeners[type]?this._listeners[type].indexOf(callback)>=0:false}},{key:"once",value:function once(type,callback){var _this=this;return this.addEventListener(type,function(){callback.apply(void 0,arguments);_this.removeEventListener.apply(_this,arguments)})}}]);return EventEmitter}();exports["default"]=EventEmitter;EventEmitter.prototype.on=EventEmitter.prototype.addEventListener;EventEmitter.prototype.off=EventEmitter.prototype.removeEventListener},{}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.KEYPRESS=exports.KEYUP=exports.KEYDOWN=exports.CLICK=exports.MOUSEOUT=exports.MOUSEMOVE=exports.MOUSEDOWN=exports.MOUSEUP=void 0;var MOUSEUP="mouseup";exports.MOUSEUP=MOUSEUP;var MOUSEDOWN="mousedown";exports.MOUSEDOWN=MOUSEDOWN;var MOUSEMOVE="mousemove";exports.MOUSEMOVE=MOUSEMOVE;var MOUSEOUT="mouseout";exports.MOUSEOUT=MOUSEOUT;var CLICK="click";exports.CLICK=CLICK;var KEYDOWN="keydown";exports.KEYDOWN=KEYDOWN;var KEYUP="keyup";exports.KEYUP=KEYUP;var KEYPRESS="keypress";exports.KEYPRESS=KEYPRESS},{}],15:[function(require,module,exports){"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _PrimitiveComponent2=_interopRequireDefault(require("./PrimitiveComponent"));var _Renderer=require("./Renderer");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var Image=function(_PrimitiveComponent){_inherits(Image,_PrimitiveComponent);var _super=_createSuper(Image);function Image(options){var _this;_classCallCheck(this,Image);_this=_super.call(this,options);_this.unscaledImage=options.image;return _this}_createClass(Image,[{key:"boundingBox",get:function get(){var compoundScale=this.compoundScale;var offset=this.offset;return{top:offset.y,left:offset.x,bottom:offset.y+compoundScale.scaleHeight*this.unscaledImage.height,right:offset.x+compoundScale.scaleWidth*this.unscaledImage.width}}},{key:"render",value:function render(){var scale=this.compoundScale;var image=new window.Image;image.src=this.unscaledImage.src;image.width=this.unscaledImage.width*scale.scaleWidth;image.height=this.unscaledImage.height*scale.scaleHeight;(0,_Renderer.drawImage)(0,0,image,this._prerenderingContext,this.style)}}]);return Image}(_PrimitiveComponent2["default"]);exports["default"]=Image},{"./PrimitiveComponent":17,"./Renderer":19}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _vectorious=require("vectorious");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var Line=function(){function Line(anchor,direction){_classCallCheck(this,Line);this.p1=anchor;this.direction=direction;this.p2=_vectorious.Vector.add(this.p1,this.direction)}_createClass(Line,[{key:"intersectionWith",value:function intersectionWith(l){return Line.intersection(this,l)}}],[{key:"intersection",value:function intersection(l1,l2){var x1=l1.p1.x,x2=l1.p2.x,x3=l2.p1.x,x4=l2.p2.x;var y1=l1.p1.y,y2=l1.p2.y,y3=l2.p1.y,y4=l2.p2.y;var denominator=(x1-x2)*(y3-y4)-(y1-y2)*(x3-x4);if(denominator===0){return null}var xNumerator=(x1*y2-y1*x2)*(x3-x4)-(x1-x2)*(x3*y4-y3*x4);var yNumerator=(x1*y2-y1*x2)*(y3-y4)-(y1-y2)*(x3*y4-y3*x4);return new _vectorious.Vector([xNumerator/denominator,yNumerator/denominator])}}]);return Line}();exports["default"]=Line},{vectorious:5}],17:[function(require,module,exports){"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _vectorious=require("vectorious");var _EventEmitter2=_interopRequireDefault(require("./EventEmitter"));var Defaults=_interopRequireWildcard(require("./Defaults"));var _Renderer=require("./Renderer");function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap;var cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj)}return newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var defaults={fillStyle:Defaults.FILL_STYLE,strokeStyle:Defaults.STROKE_STYLE,lineCap:Defaults.LINE_CAP,lineWidth:Defaults.LINE_WIDTH,lineJoin:Defaults.LINE_JOIN,miterLimit:Defaults.MITER_LIMIT,font:Defaults.FONT,textAlign:Defaults.TEXT_ALIGN,textBaseline:Defaults.TEXT_BASELINE,lineDash:[]};var PrimitiveComponent=function(_EventEmitter){_inherits(PrimitiveComponent,_EventEmitter);var _super=_createSuper(PrimitiveComponent);function PrimitiveComponent(options){var _this;_classCallCheck(this,PrimitiveComponent);_this=_super.call(this);options=options||{};_this._needsDraw=true;_this._needsRender=true;_this._scaleWidth=1;_this._scaleHeight=1;_this._d=new _vectorious.Vector([options.x||0,options.y||0]);_this.style=Object.assign({},defaults,options.style);_this._prerenderingCanvas=document.createElement("canvas");_this._prerenderingContext=_this._prerenderingCanvas.getContext("2d");_this._parent=options.parent||null;return _this}_createClass(PrimitiveComponent,[{key:"offset",get:function get(){return this.parent?_vectorious.Vector.add(this.d,this.parent.offset):this.d}},{key:"needsDraw",get:function get(){return this._needsDraw},set:function set(val){if(this.parent&&val){this.parent.needsDraw=val;this.parent.needsRender=true}this._needsDraw=val}},{key:"needsRender",get:function get(){return this._needsRender},set:function set(val){if(this.parent&&val){this.parent.needsRender=val}this._needsRender=val}},{key:"scaleWidth",get:function get(){return this._scaleWidth},set:function set(val){this._scaleWidth=val;this.needsRender=true;this.needsDraw=true;var _iterator=_createForOfIteratorHelper(this.children),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var c=_step.value;c.needsRender=true;c.needsDraw=true}}catch(err){_iterator.e(err)}finally{_iterator.f()}}},{key:"scaleHeight",get:function get(){return this._scaleHeight},set:function set(val){this._scaleHeight=val;this.needsRender=true;this.needsDraw=true;var _iterator2=_createForOfIteratorHelper(this.children),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var c=_step2.value;c.needsRender=true;c.needsDraw=true}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}},{key:"scale",get:function get(){return{scaleWidth:this.scaleWidth,scaleHeight:this.scaleHeight}},set:function set(val){this.scaleHeight=val;this.scaleWidth=val}},{key:"compoundScale",get:function get(){return{scaleWidth:this.parent?this.scaleWidth*this.parent.compoundScale.scaleWidth:this.scaleWidth,scaleHeight:this.parent?this.scaleHeight*this.parent.compoundScale.scaleHeight:this.scaleHeight}}},{key:"d",get:function get(){return this._d},set:function set(val){this._d=val}},{key:"parent",get:function get(){return this._parent},set:function set(val){this._parent=val}},{key:"draw",value:function draw(context,offset){var boundingBox=this.boundingBox;this.needsDraw=false;if(this.needsRender&&this.render){this._prerenderingCanvas.width=boundingBox.right-boundingBox.left;this._prerenderingCanvas.height=boundingBox.bottom-boundingBox.top;(0,_Renderer.clearRect)(0,0,this._prerenderingCanvas.width,this._prerenderingCanvas.height,this._prerenderingContext);this.render();this.needsRender=false}var x=boundingBox.left+(offset&&offset.left?offset.left:0);var y=boundingBox.top+(offset&&offset.top?offset.top:0);(0,_Renderer.drawImage)(x,y,this._prerenderingCanvas,context,this.style)}},{key:"render",value:function render(){}},{key:"pointIsInBoundingBox",value:function pointIsInBoundingBox(x,y){var boundingBox=this.boundingBox;return x>boundingBox.left&&y>boundingBox.top&&x<boundingBox.right&&y<boundingBox.bottom}},{key:"pointIsInObject",value:function pointIsInObject(x,y){return this.pointIsInBoundingBox(x,y)}},{key:"moveToFront",value:function moveToFront(){if(this.parent){var index=this.parent.children.indexOf(this);if(index>=0){this.parent.children.splice(index,1);this.parent.children.splice(this.parent.children.length,0,this);this.needsDraw=true}}}},{key:"moveToBack",value:function moveToBack(){if(this.parent){var index=this.parent.children.indexOf(this);if(index>=0){this.parent.children.splice(index,1);this.parent.children.splice(0,0,this);this.needsDraw=true}}}},{key:"moveForward",value:function moveForward(){if(this.parent){var index=this.parent.children.indexOf(this);if(index>=0&&index<this.parent.children.length-1){this.parent.children.splice(index,1);this.parent.children.splice(index+1,0,this);this.parent.UpdateChildrenLists();this.needsRender=true;this.needsDraw=true}}}},{key:"moveBackward",value:function moveBackward(){if(this.parent){var index=this.parent.children.indexOf(this);if(index>0){this.parent.children.splice(index,1);this.parent.children.splice(index-1,0,this);this.parent.UpdateChildrenLists();this.needsRender=true;this.needsDraw=true}}}}]);return PrimitiveComponent}(_EventEmitter2["default"]);exports["default"]=PrimitiveComponent},{"./Defaults":11,"./EventEmitter":13,"./Renderer":19,vectorious:5}],18:[function(require,module,exports){"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _PrimitiveComponent2=_interopRequireDefault(require("./PrimitiveComponent"));var _Renderer=require("./Renderer");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var Rectangle=function(_PrimitiveComponent){_inherits(Rectangle,_PrimitiveComponent);var _super=_createSuper(Rectangle);function Rectangle(options){var _this;_classCallCheck(this,Rectangle);_this=_super.call(this,options);_this.width=options.width||0;_this.height=options.height||0;return _this}_createClass(Rectangle,[{key:"boundingBox",get:function get(){var offset=this.offset;var compoundScale=this.compoundScale;return{top:offset.y-this.style.lineWidth,left:offset.x-this.style.lineWidth,bottom:offset.y+compoundScale.scaleHeight*this.height+this.style.lineWidth,right:offset.x+compoundScale.scaleWidth*this.width+this.style.lineWidth}}},{key:"render",value:function render(){var compoundScale=this.compoundScale;(0,_Renderer.drawRectangle)(this.style.lineWidth,this.style.lineWidth,this.width*compoundScale.scaleWidth,this.height*compoundScale.scaleHeight,this._prerenderingContext,this.style)}}]);return Rectangle}(_PrimitiveComponent2["default"]);exports["default"]=Rectangle},{"./PrimitiveComponent":17,"./Renderer":19}],19:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.clearRect=clearRect;exports.drawPath=drawPath;exports.drawPolygon=drawPolygon;exports.drawBezier=drawBezier;exports.drawRectangle=drawRectangle;exports.drawEllipse=drawEllipse;exports.drawCircle=drawCircle;exports.drawText=drawText;exports.drawImage=drawImage;function clearRect(x,y,width,height,context){context.clearRect(x,y,width,height)}function drawPath(vertices,context,style){Object.assign(context,style);context.beginPath();context.moveTo(vertices[0].x,vertices[0].y);for(var v=1;v<vertices.length;v++){context.lineTo(vertices[v].x,vertices[v].y)}context.setLineDash(style.lineDash);context.stroke()}function drawPolygon(vertices,context,style){Object.assign(context,style);context.beginPath();context.moveTo(vertices[0].x,vertices[0].y);for(var v=1;v<vertices.length;v++){context.lineTo(vertices[v].x,vertices[v].y)}context.closePath();context.setLineDash(style.lineDash);context.stroke()}function drawBezier(start,end,c1,c2,context,style){Object.assign(context,style);context.beginPath();context.moveTo(start.x,start.y);context.bezierCurveTo(c1.x,c1.y,c2.x,c2.y,end.x,end.y);context.setLineDash(style.lineDash);context.stroke();context.closePath()}function drawRectangle(x,y,width,height,context,style){Object.assign(context,style);context.rect(x,y,width,height);context.fill();context.setLineDash(style.lineDash);context.stroke()}function drawEllipse(x,y,radius,minorRadius,context,style){Object.assign(context,style);context.ellipse(x,y,radius,minorRadius,0,0,2*Math.PI);context.fill();context.setLineDash(style.lineDash);context.stroke()}function drawCircle(x,y,radius,context,style){Object.assign(context,style);context.arc(x,y,radius,0,2*Math.PI);context.fill();context.setLineDash(style.lineDash);context.stroke()}function drawText(x,y,text,context,style){Object.assign(context,style);context.fillText(text,x,y)}function drawImage(x,y,image,context,style){Object.assign(context,style);if(image.width>0&&image.height>0){context.drawImage(image,x,y,image.width,image.height)}}},{}],20:[function(require,module,exports){"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _PrimitiveComponent2=_interopRequireDefault(require("./PrimitiveComponent"));var _Renderer=require("./Renderer");var TextUtils=_interopRequireWildcard(require("./TextUtilities"));var TextDefaults=_interopRequireWildcard(require("./TextDefaults"));function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap;var cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj)}return newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var Text=function(_PrimitiveComponent){_inherits(Text,_PrimitiveComponent);var _super=_createSuper(Text);function Text(options){var _this;_classCallCheck(this,Text);_this=_super.call(this,options);_this.text=options.text;_this.fontSize=options.fontSize||TextDefaults.FONT_SIZE;_this.fontFamily=options.fontFamily||TextDefaults.FONT_FAMILY;_this.fontStyle=options.fontStyle||TextDefaults.FONT_STYLE;_this.fontVariant=options.fontVariant||TextDefaults.FONT_VARIANT;_this.fontWeight=options.fontWeight||TextDefaults.FONT_WEIGHT;_this.lineHeight=options.lineHeight||TextDefaults.LINE_HEIGHT;_this.textAlign=options.textAlign||TextDefaults.TEXT_ALIGN;_this.textBaseline=options.textBaseline||TextDefaults.TEXT_BASELINE;_this._textMetricsNeedUpdate=true;_this._textMetrics=null;return _this}_createClass(Text,[{key:"fontString",get:function get(){return TextUtils.formatFontString(this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.lineHeight,this.fontFamily)}},{key:"textMetrics",get:function get(){if(this._textMetricsNeedUpdate||this._textMetrics===null){this._updateStyle();this._textMetrics=TextUtils.measureText(this.text,this._prerenderingContext,this.style);Object.assign(this._textMetrics,TextUtils.getTextHeight(this.style.font));this._textMetricsNeedUpdate=false}return this._textMetrics}},{key:"boundingBox",get:function get(){return{top:this.offset.y-this.textMetrics.ascent,left:this.offset.x,bottom:this.offset.y+this.textMetrics.descent,right:this.offset.x+this.textMetrics.width}}},{key:"_updateStyle",value:function _updateStyle(options){Object.assign(this.style,options,{font:this.fontString,textAlign:this.textAlign,textBaseline:this.textBaseline})}},{key:"render",value:function render(){this._textMetricsNeedUpdate=true;this._updateStyle();(0,_Renderer.drawText)(0,this.textMetrics.ascent,this.text,this._prerenderingContext,this.style)}}]);return Text}(_PrimitiveComponent2["default"]);exports["default"]=Text},{"./PrimitiveComponent":17,"./Renderer":19,"./TextDefaults":21,"./TextUtilities":22}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TEXT_BASELINE=exports.TEXT_ALIGN=exports.LINE_HEIGHT=exports.FONT_WEIGHT=exports.FONT_VARIANT=exports.FONT_STYLE=exports.FONT_FAMILY=exports.FONT_SIZE=void 0;var FONT_SIZE="16px";exports.FONT_SIZE=FONT_SIZE;var FONT_FAMILY="sans-serif";exports.FONT_FAMILY=FONT_FAMILY;var FONT_STYLE="normal";exports.FONT_STYLE=FONT_STYLE;var FONT_VARIANT="normal";exports.FONT_VARIANT=FONT_VARIANT;var FONT_WEIGHT="normal";exports.FONT_WEIGHT=FONT_WEIGHT;var LINE_HEIGHT="normal";exports.LINE_HEIGHT=LINE_HEIGHT;var TEXT_ALIGN="start";exports.TEXT_ALIGN=TEXT_ALIGN;var TEXT_BASELINE="alphabetic";exports.TEXT_BASELINE=TEXT_BASELINE},{}],22:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getTextHeight=getTextHeight;exports.formatFontString=formatFontString;exports.measureText=measureText;var ALL_CHARS="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm.,`~;:'\"!?@#$%^&*()_+={}[]|<>/";function getTextHeight(font){var fontHolder=document.createElement("span");fontHolder.innerText=ALL_CHARS;fontHolder.style.font=font;var baselineRuler=document.createElement("div");baselineRuler.style.display="inline-block";baselineRuler.style.width="1px";baselineRuler.style.height="0";baselineRuler.style.verticalAlign="baseline";var wrapper=document.createElement("div");wrapper.appendChild(fontHolder);wrapper.appendChild(baselineRuler);wrapper.style.whiteSpace="nowrap";document.body.appendChild(wrapper);var fontRect=fontHolder.getBoundingClientRect();var baselineRect=baselineRuler.getBoundingClientRect();var fontTop=fontRect.top+document.body.scrollTop;var fontBottom=fontTop+fontRect.height;var baseline=baselineRect.top+document.body.scrollTop;document.body.removeChild(wrapper);var ascentFromBaseline=baseline-fontTop;var descentFromBaseline=fontBottom-baseline;return{height:fontRect.height,ascent:ascentFromBaseline,descent:descentFromBaseline}}function formatFontString(fontStyle,fontVariant,fontWeight,fontSize,lineHeight,fontFamily){return"".concat(fontStyle," ").concat(fontVariant," ").concat(fontWeight," ").concat(fontSize,"/").concat(lineHeight," ").concat(fontFamily)}function measureText(text,context,style){Object.assign(context,style);return context.measureText(text)}},{}],23:[function(require,module,exports){"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _vectorious=require("vectorious");var _PrimitiveComponent2=_interopRequireDefault(require("./PrimitiveComponent"));var _Renderer=require("./Renderer");var _Line=_interopRequireDefault(require("./Line"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return _get(target,property,receiver||target)}function set(target,property,value,receiver){if(typeof Reflect!=="undefined"&&Reflect.set){set=Reflect.set}else{set=function set(target,property,value,receiver){var base=_superPropBase(target,property);var desc;if(base){desc=Object.getOwnPropertyDescriptor(base,property);if(desc.set){desc.set.call(receiver,value);return true}else if(!desc.writable){return false}}desc=Object.getOwnPropertyDescriptor(receiver,property);if(desc){if(!desc.writable){return false}desc.value=value;Object.defineProperty(receiver,property,desc)}else{_defineProperty(receiver,property,value)}return true}}return set(target,property,value,receiver)}function _set(target,property,value,receiver,isStrict){var s=set(target,property,value,receiver||target);if(!s&&isStrict){throw new Error("failed to set property")}return value}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}var VectorPath=function(_PrimitiveComponent){_inherits(VectorPath,_PrimitiveComponent);var _super=_createSuper(VectorPath);function VectorPath(options){var _this;_classCallCheck(this,VectorPath);_this=_super.call(this,options);_this._vertices=[];_this.vertices=options.vertices||[];_this._zeroedBoundingBox=null;return _this}_createClass(VectorPath,[{key:"boundingBox",get:function get(){this._zeroedBoundingBox={top:0,left:0,right:this._right-this._left,bottom:this._bottom-this._top};return{top:this._zeroedBoundingBox.top+this.offset.y-this.style.lineWidth,left:this._zeroedBoundingBox.left+this.offset.x-this.style.lineWidth,bottom:this._zeroedBoundingBox.bottom+this.offset.y+this.style.lineWidth,right:this._zeroedBoundingBox.right+this.offset.x+this.style.lineWidth}}},{key:"vertices",get:function get(){return this._vertices},set:function set(verts){var _this2=this;this._vertices=verts.map(function(v){return new _vectorious.Vector([v.x,v.y])});var yCoordinates=this.vertices.map(function(v){return v.y});var xCoordinates=this.vertices.map(function(v){return v.x});this._left=Math.min.apply(null,xCoordinates);this._top=Math.min.apply(null,yCoordinates);this._right=Math.max.apply(null,xCoordinates);this._bottom=Math.max.apply(null,yCoordinates);_set(_getPrototypeOf(VectorPath.prototype),"d",new _vectorious.Vector([this._left,this._top]),this,true);this._zeroedVertices=this.vertices.map(function(v){return v.subtract(_this2.d)});_set(_getPrototypeOf(VectorPath.prototype),"needsDraw",true,this,true);_set(_getPrototypeOf(VectorPath.prototype),"needsRender",true,this,true)}},{key:"pointIsInObject",value:function pointIsInObject(x,y){var inside=false;if(_get(_getPrototypeOf(VectorPath.prototype),"pointIsInObject",this).call(this,x,y)){var l=new _Line["default"](new _vectorious.Vector([x,y]),new _vectorious.Vector([1,0]));var compoundScale=this.compoundScale;var offset=this.offset;for(var i=0;i<this._zeroedVertices.length;i++){var j=i+1>=this._zeroedVertices.length?0:i+1;var v=_scaleVectorXY(this._zeroedVertices[i],compoundScale.scaleWidth,compoundScale.scaleHeight).add(offset);var w=_scaleVectorXY(this._zeroedVertices[j],compoundScale.scaleWidth,compoundScale.scaleHeight).add(offset);var edgeDirection=_vectorious.Vector.subtract(w,v).normalize();var edge=new _Line["default"](v,edgeDirection);var intersection=edge.intersectionWith(l);if(intersection===null){continue}var intersectToTheRight=intersection.x-x>=Number.EPSILON;if(!intersectToTheRight){continue}var negativeX=edgeDirection.x<-Number.EPSILON;var negativeY=edgeDirection.y<-Number.EPSILON;var leftVertex=negativeX?w:v;var rightVertex=negativeX?v:w;var topVertex=negativeY?w:v;var bottomVertex=negativeY?v:w;var intersectWithinSegment=intersection.x-leftVertex.x>=Number.EPSILON&&rightVertex.x-intersection.x>=Number.EPSILON&&intersection.y-topVertex.y>=Number.EPSILON&&bottomVertex.y-intersection.y>=Number.EPSILON;if(intersectWithinSegment){inside=!inside}}}return inside}},{key:"render",value:function render(){var boundingBox=this.boundingBox;var offset=this.offset;var compoundScale=this.compoundScale;var pathToDraw=this._zeroedVertices.map(function(vertex){return vertex.subtract(new _vectorious.Vector([boundingBox.left,boundingBox.top])).add(offset)});(0,_Renderer.drawPath)(pathToDraw,this._prerenderingContext,this.style)}}]);return VectorPath}(_PrimitiveComponent2["default"]);exports["default"]=VectorPath;function _scaleVectorXY(vector,scaleX,scaleY){return new _vectorious.Vector([vector.x*scaleX,vector.y*scaleY])}},{"./Line":16,"./PrimitiveComponent":17,"./Renderer":19,vectorious:5}],24:[function(require,module,exports){"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"Compositor",{enumerable:true,get:function get(){return _Compositor["default"]}});Object.defineProperty(exports,"PrimitiveComponent",{enumerable:true,get:function get(){return _PrimitiveComponent["default"]}});Object.defineProperty(exports,"Composition",{enumerable:true,get:function get(){return _Composition["default"]}});Object.defineProperty(exports,"Circle",{enumerable:true,get:function get(){return _Circle["default"]}});Object.defineProperty(exports,"Ellipse",{enumerable:true,get:function get(){return _Ellipse["default"]}});Object.defineProperty(exports,"Rectangle",{enumerable:true,get:function get(){return _Rectangle["default"]}});Object.defineProperty(exports,"Line",{enumerable:true,get:function get(){return _Line["default"]}});Object.defineProperty(exports,"VectorPath",{enumerable:true,get:function get(){return _VectorPath["default"]}});Object.defineProperty(exports,"Bezier",{enumerable:true,get:function get(){return _Bezier["default"]}});Object.defineProperty(exports,"Image",{enumerable:true,get:function get(){return _Image["default"]}});Object.defineProperty(exports,"Text",{enumerable:true,get:function get(){return _Text["default"]}});exports.Renderer=exports.Events=void 0;var _Compositor=_interopRequireDefault(require("./Compositor"));var _Events=_interopRequireWildcard(require("./Events"));exports.Events=_Events;var _Renderer=_interopRequireWildcard(require("./Renderer"));exports.Renderer=_Renderer;var _PrimitiveComponent=_interopRequireDefault(require("./PrimitiveComponent"));var _Composition=_interopRequireDefault(require("./Composition"));var _Circle=_interopRequireDefault(require("./Circle"));var _Ellipse=_interopRequireDefault(require("./Ellipse"));var _Rectangle=_interopRequireDefault(require("./Rectangle"));var _Line=_interopRequireDefault(require("./Line"));var _VectorPath=_interopRequireDefault(require("./VectorPath"));var _Bezier=_interopRequireDefault(require("./Bezier"));var _Image=_interopRequireDefault(require("./Image"));var _Text=_interopRequireDefault(require("./Text"));function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap;var cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj}}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj)}return newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./Bezier":7,"./Circle":8,"./Composition":9,"./Compositor":10,"./Ellipse":12,"./Events":14,"./Image":15,"./Line":16,"./PrimitiveComponent":17,"./Rectangle":18,"./Renderer":19,"./Text":20,"./VectorPath":23}]},{},[24])(24)});
