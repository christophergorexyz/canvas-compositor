{"version":3,"file":"composition.js","names":["Composition","options","_children","children","top","Infinity","left","bottom","right","c","boundingBox","Math","min","max","x","y","filter","PointIsInObject","length","pointIsInObject","child","parent","push","addChild","index","indexOf","splice","offset","draw","_prerenderingContext","PrimitiveComponent"],"sources":["../../src/context-2d/composition.mjs"],"sourcesContent":["import PrimitiveComponent from './primitive-component.mjs';\n\n/**\n * The Composition class is an extension of the Primitive that is\n * composed of other extensions of the Primitive. The Composition\n * is used to establish the Scene graph as the parent of all other\n * objects on screen. This is the key abstraction of the [composite\n * pattern](https://en.wikipedia.org/wiki/Composite_pattern): an\n * action taken on the parent element acts upon all of the children,\n * and transatively, all of their children.\n */\nexport default class Composition extends PrimitiveComponent {\n  /**\n   * @param {object} options object settings\n   */\n  constructor(options) {\n    super(options);\n    options = options || {};\n    /**\n     * The children of this composition\n     */\n    this._children = options.children || [];\n  }\n\n  /**\n   * children of this composition\n   * @type {Array}\n   */\n  get children() {\n    return this._children;\n  }\n\n  /**\n   * the bounding box of the composition (i.e., the containing bounds of all the children of this composition)\n   * @type {{top:number, left:number, right:number, bottom:number}}\n   */\n  get boundingBox() {\n    let top = Infinity,\n      left = Infinity,\n      bottom = -Infinity,\n      right = -Infinity;\n\n    for (let c of this.children) {\n      let boundingBox = c.boundingBox;\n      top = Math.min(boundingBox.top, top);\n      left = Math.min(boundingBox.left, left);\n      bottom = Math.max(boundingBox.bottom, bottom);\n      right = Math.max(boundingBox.right, right);\n    }\n\n    return {\n      top: top,\n      left: left,\n      bottom: bottom,\n      right: right\n    };\n  }\n\n\n  /**\n   * the an array of children that are found at (x, y)\n   * @return {object} childrenAt all the children below the point\n   * @param {number} x the x coordinate\n   * @param {number} y the y coordinate\n   */\n  childrenAt(x, y) {\n    return this.children.filter((c) => c.PointIsInObject(x, y));\n  }\n\n  /**\n   * get the top-most child at the (x, y)\n   * @return {object} childAt the first child below the point\n   * @param {number} x the x coordinate\n   * @param {number} y the y coordinate\n   */\n  childAt(x, y) {\n    //loop over the children in reverse because drawing order\n    for (var c = this.children.length - 1; c >= 0; c--) {\n      if (this.children[c].pointIsInObject(x, y)) {\n        return this.children[c];\n      }\n    }\n  }\n\n  /**\n   * add a child to this composition\n   * @param {object} child the child to be added\n   */\n  addChild(child) {\n    child.parent = this;\n    this.children.push(child);\n    super.needsRender = true;\n    super.needsDraw = true;\n    //TODO: make this hook more generic\n    //by using a registry\n    //if (this.onchildadded) {\n    //  this.onchildadded();\n    //}\n  }\n\n  /**\n   * add multiple children to the composition\n   * @param {object} children the list of children to be added\n   */\n  addChildren(children) {\n    for (let c of children) {\n      this.addChild(c);\n    }\n  }\n\n  /**\n   * remove a child from this composition\n   * @param {object} child the child to be removed\n   * @return {object} the child removed\n   */\n  removeChild(child) {\n    if (child) {\n      var index = this.children.indexOf(child);\n      if (index >= 0) {\n        super.needsRender = true;\n        super.needsDraw = true;\n        return this.children.splice(index, 1);\n      }\n    }\n  }\n\n  /**\n   * override the render function to render the children onto this compositions prerendering canvas\n   * @override\n   */\n  render() {\n    // required to make sure that the drawing occurs within the bounds of this composition\n    let boundingBox = this.boundingBox;\n    var offset = {\n      top: -boundingBox.top,\n      left: -boundingBox.left,\n      bottom: -boundingBox.bottom,\n      right: -boundingBox.right\n    };\n\n    for (let c of this.children) {\n      c.draw(this._prerenderingContext, offset);\n    }\n\n    // `destination-out` will erase things\n    //this._prerenderingContext.globalCompositeOperation = 'destination-out';\n    //_.each(this.masks, function (m) {\n    //m.draw(renderContext, contextOffset);\n    //});\n    //renderContext.globalCompositeOperation = 'normal';\n  }\n}\n"],"mappings":"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"}