{"version":3,"sources":["../src/Bezier.js"],"names":["_cubicBezier","start","c1","c2","end","t","_getExtremes","a","b","c","solutions","localExtrema","disc","Math","abs","push","sqrt","Error","Bezier","options","Vector","x","y","control1","control2","_boundingBox","_boundingBoxNeedsUpdate","xExtrema","yExtrema","min","apply","_normalizationVector","d","_start","subtract","_end","_control1","_control2","Renderer","drawBezier","_prerenderingContext","style","lineWidth","offset","add","top","right","max","bottom","left","PrimitiveComponent"],"mappings":"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","sourcesContent":["import { Renderer } from './Renderer';\nimport { PrimitiveComponent } from './PrimitiveComponent';\nimport { Vector } from 'vectorious';\n\n//uhh... i looked up *SO* much stuff on this, and even tried to work out the math myself,\n//but this is ridiculous - where does this come from?\nfunction _cubicBezier(start, c1, c2, end, t) {\n    return start * (1 - t) * (1 - t) * (1 - t) + 3 * c1 * t * (1 - t) * (1 - t) + 3 * c2 * t * t * (1 - t) + end * t * t * t;\n}\n\n\nfunction _getExtremes(start, c1, c2, end) {\n\n    let a = 3 * end - 9 * c2 + 9 * c1 - 3 * start;\n    let b = 6 * c2 - 12 * c1 + 6 * start;\n    let c = 3 * c1 - 3 * start;\n\n    let solutions = [];\n    let localExtrema = [];\n\n    //\"discriminant\"\n    let disc = b * b - 4 * a * c;\n\n    if (disc >= 0) {\n        if (!Math.abs(a) > 0 && Math.abs(b) > 0) {\n            solutions.push(-c / b);\n        } else if (Math.abs(a) > 0) {\n            solutions.push((-b + Math.sqrt(disc)) / (2 * a));\n            solutions.push((-b - Math.sqrt(disc)) / (2 * a));\n        } else {\n            throw new Error(\"no solutions!?!?!\");\n        }\n\n        for (let t of solutions) {\n            if (0 <= t && t <= 1) {\n                localExtrema.push(_cubicBezier(start, c1, c2, end, t));\n            }\n        }\n    }\n\n    localExtrema.push(start, end);\n\n    return localExtrema;\n}\n\nexport class Bezier extends PrimitiveComponent {\n    constructor(options) {\n        super(options);\n\n        let start = new Vector([options.start.x, options.start.y]);\n        let end = new Vector([options.end.x, options.end.y]);\n        let control1 = new Vector([options.control1.x, options.control1.y]);\n        let control2 = new Vector([options.control2.x, options.control2.y]);\n\n        this._boundingBox = null;\n        this._boundingBoxNeedsUpdate = true;\n\n        let xExtrema = _getExtremes(start.x, control1.x, control2, end.x);\n        let yExtrema = _getExtremes(start.y, control1.y, control2.y, end.y);\n        super.d = new Vector([Math.min.apply(null, xExtrema), Math.min.apply(null, yExtrema)])\n\n        this._normalizationVector = this.d;\n\n        this._start = Vector.subtract(start, this._normalizationVector);\n        this._end = Vector.subtract(end, this._normalizationVector);\n        this._control1 = Vector.subtract(control1, this._normalizationVector);\n        this._control2 = Vector.subtract(control2, this._normalizationVector);\n    }\n\n    get boundingBox() {\n        //if (this._boundingBox === null || this._boundingBoxNeedsUpdate) {\n        let lineWidth = this.style.lineWidth;\n\n        let offset = this.offset;\n        let start = Vector.add(this._start, this.offset);\n        let control1 = Vector.add(this._control1, this.offset);\n        let control2 = Vector.add(this._control2, this.offset);\n        let end = Vector.add(this._end, this.offset);\n\n        let xExtrema = _getExtremes(start.x, control1.x, control2, end.x);\n        let yExtrema = _getExtremes(start.y, control1.y, control2.y, end.y);\n        this._boundingBox = {\n            top: Math.min.apply(null, yExtrema) - lineWidth,\n            right: Math.max.apply(null, xExtrema) + lineWidth,\n            bottom: Math.max.apply(null, yExtrema) + lineWidth,\n            left: Math.min.apply(null, xExtrema) - lineWidth\n        }\n        this._boundingBoxNeedsUpdate = false;\n        //}\n        return this._boundingBox;\n    }\n\n    render() {\n        Renderer.drawBezier(\n            this._start,\n            this._end,\n            this._control1,\n            this._control2,\n            this._prerenderingContext,\n            this.style\n        );\n    }\n}\n"],"file":"Bezier.js"}